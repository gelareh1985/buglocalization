<html>

<style>
html{
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ;
    font-size: 17px;
    display: table;
}
table,th,td {
  border: 1px solid black;
  width: 1200;
  text-align:justify;
  word-break:break-all;
}

th{
background-color: lightskyblue;
font-size: 16px;
border: none;
text-align:left;
}

td{
background-color: #d5e3c8;
font-size: 14px;
}

.container {
  position: relative;
  text-align:center;
  padding-top: 70%;
}

.responsive-iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border: 2px solid #73AD21;
}

</style>
<body>

<h2>Bug report Information</h2>
<table>

    <th colspan="2"> Bug Report </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bug Report Number </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 540712 </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Summary </td>
        <td  style="width: 80%; background-color:#f7fff0;"> Running JUnit test takes long due to Creating Type Hierarchy </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Creation Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2018-11-02T09:43:47Z </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Status </td>
        <td  style="width: 80%; background-color:#f7fff0;"> RESOLVED </td>
    </tr>

    <th colspan="2"> Bug Fix </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bugfix Commit </td>
        <td  style="width: 80%; background-color:#f7fff0;"> Bug 562763 - ClasspathJrt.cleanup() is not called by
ClasspathJrtWithReleaseOption.cleanup()

Change-Id: I11e8a046182f07740b8c71496269e1dfe979ad0d
Signed-off-by: Andrey Loskutov <loskutov@gmx.de>
 </td>
    </tr>
    <tr>
        <td  tyle="width: 20%; background-color:#d5e3c8;"> Bugfix Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2020-05-12T19:46:51Z </td>
    </tr>
    </table>
<table>

<th colspan="2"> Ranked List of Class Diagrams </th>

<tr>
<td  style="width: 20%; font-size: 10px; background-color:#d5e3c8">

            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> TypeHierarchyTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompilationUnitHelper; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavadocTest_1_4; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RunOnlyJava14Tests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ClassFileToIndexConverter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> SourceType; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IncrementalTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ClassFileToIndexConverter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ModelTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RawGrowableArray; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> TypesUtil; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BindingMap; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RegressionTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Sorting; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> FullSourceWorkspaceModelTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavaModelAccess; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTRewrite; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Util; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Database; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavaPDOM; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> EnvUtil; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> AptBuilder; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BTreeExpensiveTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompletionEngine; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverter10Test; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BuildJarIndex; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Util; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> TypesImpl; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompilationParticipant; </a> </li>
            </ul>   
            
</td>
<td  rowspan="30" style="width: 80%;  background-color:#d5e3c8"> 
    <div class="container">
    <iframe class="responsive-iframe" src="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" name="myIframe">
        <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html">SELFHTML</a>
    </iframe>
    </div>
</td>
</tr>
</table>
<table>

<th colspan="2"> Ranked List of Classifiers </th>

                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/TypeHierarchyTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.core/Lorg/eclipse/jdt/apt/core/internal/generatedfile/CompilationUnitHelper; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/JavadocTest_1_4; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/TypeHierarchyNotificationTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/dom/ASTConverter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/RunOnlyJava14Tests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/indexer/ClassFileToIndexConverter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/SourceType; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.builder/Lorg/eclipse/jdt/core/tests/builder/IncrementalTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/JavaModelManagerTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/RunOnlyJava8Tests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/pdom/indexer/ClassFileToIndexConverter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/RunAllJava14Tests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.pluggable.tests/Lorg/eclipse/jdt/apt/pluggable/tests/ModelTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.builder/Lorg/eclipse/jdt/core/tests/builder/BasicBuildTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/RawGrowableArray; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/GenericsRegressionTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/CodeCorrectionTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/java/JavaIndex; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/LambdaFactory; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.core/Lorg/eclipse/jdt/apt/core/internal/util/TypesUtil; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/hierarchy/BindingMap; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/RunAllJava10Tests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/SerializableLambdaTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.tests/Lorg/eclipse/jdt/apt/tests/RegressionTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.pluggable.tests/Lorg/eclipse/jdt/apt/pluggable/tests/BuilderTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/StreamHasher; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/TextBlockTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/util/Sorting; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/ModuleBuilderTests; </td>
                </tr>

                </table>
<table>

<th colspan="2"> Discussion </th>

        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2018-11-02T09:43:47Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> I've switched from Eclipse 4.7.3a to 4.9 and since then, running JUnit (4.12) tests of a project with 10.000+ test methods (right click on the project, select Run > As JUnit test) takes 30-60 seconds to start the status bar shows "Creating Type Hierarchy" for a long time, every time (no changes to the project inbetween).

Project: https://github.com/ReactiveX/RxJava

Additional info:
- I have the Gradle STS plugin with 4.7.3a and the (out of box) Buildship plugin in 4.9
- If I import the project as Buildship into 4.7.3a, it is slow too - not sure why as running the test should have no interaction with the plugin.

A Flight Recorder capture indicates these:

Package	Sample Count	Percentage(%)
org.eclipse.jdt.internal.core	756	28,177
org.eclipse.jdt.internal.core.search	707	26,351
org.eclipse.jdt.internal.compiler.lookup	443	16,511
java.lang	220	8,2
org.eclipse.jdt.internal.compiler.parser	195	7,268
org.eclipse.jdt.internal.compiler.util	71	2,646
org.eclipse.jdt.internal.compiler.ast	69	2,572
java.util	53	1,975


Class	Sample Count	Percentage(%)
org.eclipse.jdt.internal.core.search.JavaSearchScope	707	26,351
org.eclipse.jdt.internal.core.JavaElement	581	21,655

Stack Trace	Sample Count	Percentage(%)
org.eclipse.jdt.internal.core.search.JavaSearchScope.encloses(IJavaElement)	704	26,239
org.eclipse.jdt.internal.core.JavaElement.equals(Object)	533	19,866
java.lang.String.equals(Object)	201	7,492
org.eclipse.jdt.internal.core.SourceMethod.equals(Object)	71	2,646
org.eclipse.jdt.internal.core.JavaElement.getAncestor(int)	42	1,565
org.eclipse.jdt.internal.compiler.lookup.Scope.getTypeOrPackage(char[], int, boolean)	35	1,305
org.eclipse.jdt.internal.compiler.lookup.LookupEnvironment.createParameterizedGenericMethod(MethodBinding, TypeBinding[], boolean, boolean)	35	1,305
org.eclipse.jdt.internal.core.SourceRefElement.equals(Object)	34	1,267
org.eclipse.jdt.internal.compiler.lookup.TypeSystem.getWildcard(ReferenceBinding, int, TypeBinding, TypeBinding[], int)	33	1,23
org.eclipse.jdt.internal.compiler.parser.Parser.parse()	31	1,155 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2018-11-06T11:59:30Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> As you mention STS, what is the exact version number of plugin org.eclipse.jdt.core? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2018-11-06T12:18:54Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> In Eclipse 4.7.3a:

- org.eclipse.jdt.core: 3.13.102.v20180330-0919
- org.eclipse.buildship: 2.2.1.v20180125-1441
- Gradle IDE: 3.9.4.201805142235-RELEASE

In Eclipse 4.9:
- org.eclipse.jdt.core: 3.15.0.v20180905-0317
- org.eclipse.buildship: 2.2.1.v20180125-1441 (yes, the same as above) </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2018-11-06T12:34:45Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to David Karnok from comment #2)
> In Eclipse 4.7.3a:
> 
> - org.eclipse.jdt.core: 3.13.102.v20180330-0919
> - org.eclipse.buildship: 2.2.1.v20180125-1441
> - Gradle IDE: 3.9.4.201805142235-RELEASE
> 
> In Eclipse 4.9:
> - org.eclipse.jdt.core: 3.15.0.v20180905-0317
> - org.eclipse.buildship: 2.2.1.v20180125-1441 (yes, the same as above)

Thanks, so those are indeed original versions of jdt.core. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-07T17:58:16Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Created attachment 277802
Heap dump when create type hierarchy is running for a large project

We have been experiencing this issue as well.  When taking a heap dump during the "Creating type hierarchy" step of Run As > JUnit Test, users are seeing lots of TypeBound[] instances.

I think org.eclipse.jdt.internal.compiler.lookup.BoundSet is aggressively creating and copying arrays.  I will post a patch that reduces this somewhat. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-07T18:02:33Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Created attachment 277803
Proposed changes to reduce TypeBound[] instances

Here are some proposed changes that can reduce the amount of TypeBound[] instances when creating Type Hierarchy. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-08T13:07:46Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eric Milles from comment #5)
> Created attachment 277803 [details]
> Proposed changes to reduce TypeBound[] instances
> 
> Here are some proposed changes that can reduce the amount of TypeBound[]
> instances when creating Type Hierarchy.

Eric, could you please create Gerrit patch? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-08T13:57:12Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Sorry, not sure how to deal with Gerrit.

I am just proposing these changes for further investigation.  I don't know the origin of the 1024 array size, so my reduction to 4 may be reducing memory footprint but hurting performance.


Quick note: These changes reduced my Run As > JUnit startup time from 1:42 to 1:25, so there is likely more to be done.  But it did help developers getting OutOfMemoryErrors successfully start their tests. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-08T14:12:35Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eric Milles from comment #7)
> Sorry, not sure how to deal with Gerrit.

May be this helps: https://wiki.eclipse.org/Platform_UI/How_to_Contribute ?
A Gerrit patch allows us to work with the contribution and discuss directly on the code. If the patch is OK, it could be also directly merged. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-08T14:50:32Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> I'm not working directly from JDT Core or JDT UI.  I have a patched org.eclipse.jdt.core that I used to try something out quickly. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-10T18:52:50Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eric Milles from comment #5)
> Created attachment 277803 [details]
> Proposed changes to reduce TypeBound[] instances
> 
> Here are some proposed changes that can reduce the amount of TypeBound[]
> instances when creating Type Hierarchy.

Thanks.

While this is a sensitive code area, avoiding creation of empty arrays is a valid pattern, already used in various places in the compiler.

(In reply to Eric Milles from comment #7)
> Sorry, not sure how to deal with Gerrit.

It's OK, I can work with an "old-school" patch :)

> I am just proposing these changes for further investigation.  I don't know
> the origin of the 1024 array size, so my reduction to 4 may be reducing
> memory footprint but hurting performance.

My guess is that 4 is a bit too low. Would you be able to measure if a compromise, say 16, would already have a similarly positive effect?
 
 
> Quick note: These changes reduced my Run As > JUnit startup time from 1:42
> to 1:25, so there is likely more to be done.  But it did help developers
> getting OutOfMemoryErrors successfully start their tests.

So we assume the speed-up is directly linked to less GC pressure? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-11T16:43:55Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> I ran tests locally and the array that was once 1024 by default was never grown from size 4 to 8.  So I'm happy with the size 4; the code to increase its size when necessary remains in place.

Yes, in this case we achieved performance boost by reduction of allocations plus the array copy operations in copy() method. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-12T16:49:02Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> With some additional testing on a larger project, I did hit the array growth code with size 4.  8 or 16 would probably make a better default value. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-13T21:50:55Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> It seems the longest part of Create Type Hierarchy is "parsedUnit.scope.faultInTypes(); parsedUnit.resolve();" which happens near the end of "HierarchyResolver.resolve(Openable[] openables, HashSet localTypes, IProgressMonitor monitor)".

JUnit search for tests uses RegionBasedTypeHierarchy when initiated from a source folder or package.  And RBTH passes null for the localTypes parameter, so this code always sets containsLocalType to true:

	// contains a potential subtype as a local or anonymous type?
	boolean containsLocalType = false;
	if (localTypes == null) { // case of hierarchy on region
		containsLocalType = true;
	} else {
		containsLocalType = cu.isWorkingCopy() ? true /* presume conservatively */ : localTypes.contains(cu.getPath().toString());
	}


Is there a more accurate way to check for local types from an org.eclipse.jdt.core.ICompilationUnit or org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration?  If so, this flag could be set to false more often than not and quite expensive type resolution could be skipped.  In my case I could go from over 70 seconds to 42 seconds.


What sorts of things fail if this resolution is skipped for region-based type hierarchies? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-13T22:00:08Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Created attachment 277857
Proposed changes to HierarchyResolver to reduce creation of progress monitors

I think the use of SubMonitor.split(1) should be replaced by IProgressMonitor.worked(1) to reduce the creation of possibly thousands of unused progress monitor instances. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-14T17:31:12Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eric Milles from comment #13)
> In my case I could go from over 70 seconds to 42 seconds.

Actually type hierarchy went from 70399 ms to 8279 ms.  The total time to launch JUnit tests went from ~104 seconds to ~52 seconds. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-14T18:08:57Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eric Milles from comment #14)
> Created attachment 277857 [details]
> Proposed changes to HierarchyResolver to reduce creation of progress monitors
> 
> I think the use of SubMonitor.split(1) should be replaced by
> IProgressMonitor.worked(1) to reduce the creation of possibly thousands of
> unused progress monitor instances.

Full replacement would not be a good idea, since only split() supports cancelling, worked() doesn't. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-14T18:24:36Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eric Milles from comment #13)
> It seems the longest part of Create Type Hierarchy is
> "parsedUnit.scope.faultInTypes(); parsedUnit.resolve();" which happens near
> the end of "HierarchyResolver.resolve(Openable[] openables, HashSet
> localTypes, IProgressMonitor monitor)".
> 
> JUnit search for tests uses RegionBasedTypeHierarchy when initiated from a
> source folder or package.  And RBTH passes null for the localTypes
> parameter, so this code always sets containsLocalType to true:
> 
> 	// contains a potential subtype as a local or anonymous type?
> 	boolean containsLocalType = false;
> 	if (localTypes == null) { // case of hierarchy on region
> 		containsLocalType = true;
> 	} else {
> 		containsLocalType = cu.isWorkingCopy() ? true /* presume conservatively */
> : localTypes.contains(cu.getPath().toString());
> 	}
> 
> 
> Is there a more accurate way to check for local types from an
> org.eclipse.jdt.core.ICompilationUnit or
> org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration?  If so,
> this flag could be set to false more often than not and quite expensive type
> resolution could be skipped.  In my case I could go from over 70 seconds to
> 42 seconds.

That's a very interesting find!

The parser sets #bits |= ASTNode.HasLocalType on each field, method or type directly containing a local type. I'm not sure if this could additionally be propagated further out, e.g., to the CUD. bit 2 seems to be unused for CUD, so it's worth a try.
If not, a coarse grained AST traversal should still be fast enough for this purpose.
 
 
> What sorts of things fail if this resolution is skipped for region-based
> type hierarchies?

Hierarchy would be incomplete if any local types should be seen as members of the hierarchy. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-28T16:11:03Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> I compared test start up time between current (4.11), 4.7.3a and 4.6.3.  All are taking a similar amount of time to start a batch of JUnit4 tests.  Type hierarchy and search for Test and RunWith annotations (in JUnit4TestFinder) take more than 1 minute 20 seconds for a project with ~16000 JUnit test cases.

> The parser sets #bits |= ASTNode.HasLocalType on each field, method or type directly containing a local type.

I had a look at this and I think the parser has not run far enough at the point in HierarchyResolver where the bits would be available.  Once a unit moves through "parsedUnit.scope.faultInTypes(); and parsedUnit.resolve();" these bits are indeed set.

I was wondering why the sources are re-parsed for type hierarchy.  For the purposes of Run As, aren't only class files to be considered? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-08-27T06:06:57Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Bulk move out of 4.13 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-05T21:09:34Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Sorry, we ran out of time for 4.16 M1, moving to M3 (since M2 is not a defined milestone, just on I-build that is contributed to Eclipse 2020-06), hoping to get to this soon. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-12T22:10:44Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/158126 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=b4ef933a2eb6a626ac46a0b6b74b39d792552f4a </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-12T22:14:46Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #21)
> Gerrit change https://git.eclipse.org/r/158126 was merged to [master].
> Commit:
> http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
> ?id=b4ef933a2eb6a626ac46a0b6b74b39d792552f4a

I released this optimization to master for 4.16 M3

Thanks Eric!

For book keeping I'm resolving this bug.

@Eric, if you have more improvements ready, we could possibly still add them to 4.16 via this bug.

Otherwise, for further optimization let's use a new bug. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-19T11:54:24Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Is there a way we can verify this optimization? For example, opening type hierarchy on a class X in project Y takes z% less time ! </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-07-31T13:05:29Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> I find it still unbearably slow to run a JUnit launch for multiple tests on 4.16 compared to some old Eclipse version.

- it's incredibly slow (minutes and minutes) to show the launch configuration contents in the "Run Configurations" dialog
- it's unbearably slow (minutes and minutes) to actually start the test process once you click on "Run" in the "Run Configurations" dialog or through the "Play button". In this case, the Progress View shows "Creating Type Hierarchy..." while the launch is in progress

I'm observing this on a JUnit 4 configuration containing 1632 test methods spread over 15 test classes.

What happened here? Maybe this is due the removal of the experimental new indexer? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-07-31T13:13:36Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Mauro Molinari from comment #24)
> I find it still unbearably slow to run a JUnit launch for multiple tests on
> 4.16 compared to some old Eclipse version.

Please create new bug and attach few jstack dumps created while you are waiting on launch config dialog. </td> </tr>
        </table>
</body>
</html>
