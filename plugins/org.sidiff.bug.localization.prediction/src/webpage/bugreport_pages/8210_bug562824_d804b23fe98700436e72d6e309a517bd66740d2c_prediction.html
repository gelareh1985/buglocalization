<html>

<style>
html{
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ;
    font-size: 17px;
    display: table;
}
table,th,td {
  border: 1px solid black;
  width: 1200;
  text-align:justify;
  word-break:break-all;
}

th{
background-color: lightskyblue;
font-size: 16px;
border: none;
text-align:left;
}

td{
background-color: #d5e3c8;
font-size: 14px;
}

.container {
  position: relative;
  text-align:center;
  padding-top: 70%;
}

.responsive-iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border: 2px solid #73AD21;
}

</style>
<body>

<h2>Bug report Information</h2>
<table>

    <th colspan="2"> Bug Report </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bug Report Number </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 562824 </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Summary </td>
        <td  style="width: 80%; background-color:#f7fff0;"> [14] Pattern variable with same name as outer local or field is rejected </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Creation Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2020-05-05T11:06:10Z </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Status </td>
        <td  style="width: 80%; background-color:#f7fff0;"> VERIFIED </td>
    </tr>

    <th colspan="2"> Bug Fix </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bugfix Commit </td>
        <td  style="width: 80%; background-color:#f7fff0;"> Bug 566720 - [15] public keyword should not be allowed for local
interfaces

Change-Id: Ie97ebea1c388680e5e7efdbbd3ae4e823ae9c7dc
Signed-off-by: Manoj Palat <manpalat@in.ibm.com> </td>
    </tr>
    <tr>
        <td  tyle="width: 20%; background-color:#d5e3c8;"> Bugfix Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2020-09-08T01:23:19Z </td>
    </tr>
    </table>
<table>

<th colspan="2"> Ranked List of Class Diagrams </th>

<tr>
<td  style="width: 20%; font-size: 10px; background-color:#d5e3c8">

            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CombinedBinaryExpression; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ProblemReporter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> DatabaseRef; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IProblem; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> FieldInitsFakingFlowContext; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ConstraintExpressionFormula; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IField; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BindingMap; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> NullReferenceImplTests~Generator; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavadocParser; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompilerOptions; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompletionOnReferenceExpressionName; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> LambdaExpression$LocalTypeSubstitutor; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverterJavadocTest; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> LambdaMethod; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> SelectionOnQualifiedAllocationExpression; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> AptConfig$ProcessorOptionsParser; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RunOnly335CompilerTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ClassNameTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CodeSnippetMessageSend; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> SelectionEngine; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ClassFile; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Chunk; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IncrementalImageBuilder; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> FieldChar; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTRewrite; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Factory; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> FormatterCommentsBugsTest; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> TokenTraverser; </a> </li>
            </ul>   
            
</td>
<td  rowspan="30" style="width: 80%;  background-color:#d5e3c8"> 
    <div class="container">
    <iframe class="responsive-iframe" src="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" name="myIframe">
        <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html">SELFHTML</a>
    </iframe>
    </div>
</td>
</tr>
</table>
<table>

<th colspan="2"> Ranked List of Classifiers </th>

                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/CombinedBinaryExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/problem/ProblemReporter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/DatabaseRef; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/compiler/IProblem; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/flow/FieldInitsFakingFlowContext; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/OR_OR_Expression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/lookup/ConstraintExpressionFormula; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/FieldReference; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/UnaryExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/lookup/InferenceContext18; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/InstanceOfExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/field/IField; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/CastExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/SwitchExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/Expression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/YieldStatement; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/SingleNameReference; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/ConditionalExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/QualifiedAllocationExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/hierarchy/BindingMap; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/IPolyExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/SwitchStatement; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/JavadocImplicitTypeReference; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/NullReferenceImplTests~Generator; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/ReferenceExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/parser/JavadocParser; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/impl/CompilerOptions; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/dom/ASTConverter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/LambdaExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/LocalStaticsTest_15; </td>
                </tr>

                </table>
<table>

<th colspan="2"> Discussion </th>

        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-05T11:06:10Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> This was discussed in bug 531715, comment #43 through bug 531715, comment #46. Basically, a pattern variable can shadow a field or a local variable in an outer scope, such as the following code:

class X {
	String s = "test";
	public boolean foo(Object arg) {
		if (arg instanceof String s) {
			// s is shadowed now
			if (!"foo".equals(s)) return false;
		}
		// s is not shadowed
		return "test".equals(s); // ecj rejects this
	}
}

This is legal code but the compiler rejects this code. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-05T11:08:04Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Stephan, I will shortly add unit tests for the given code and its variants. Hope you can find some time for fixing this during M3 time frame. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-05T11:33:10Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #1)
> Stephan, I will shortly add unit tests for the given code and its variants.
> Hope you can find some time for fixing this during M3 time frame.

Let me caution your expectations a bit, extracting bits from the previous bug:

(In reply to Stephan Herrmann from bug 531715 comment #46)
> [...]
> My immediate reaction: let's ignore this for now, and raise it to the EG for
> preview 2 with severity BLOCKER. Point in favor: the "swiss cheese" problem
> has already been discussed controversially within the EG. If they are
> presented with a huge problem they have overlooked, perhaps s.o. will change
> their mind.
> [...]

Must I assume that this discussion with the EG did not happen?

> [...]
> I'm afraid if ecj is forced to implement this, this requires re-architecting
> the compiler at a magnitude that's impossible to be handled by the current
> team.

(In reply to Stephan Herrmann from bug 531715 comment #48)
> While I still think, flow-dependent resolution is crazy, I rethought our
> situation more calmly, and see a slight possibility, that analyseCode could
> be made to work in a speculative mode (post [14]):

I said: "slight possibility".


My idea was, to set aside an entire milestone for you and me to exclusively collaborate on the architectural change required for the swiss cheese feature.

For 4.16 I would definitely prefer to fix a dozen or so obvious bugs elsewhere and return to this early in 4.17. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-05T12:07:33Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #2)
> Must I assume that this discussion with the EG did not happen?

Not yet. The second preview is up for review this week and I sent you a note with that mail to you and Manoj.

> > [...]
> > I'm afraid if ecj is forced to implement this, this requires re-architecting
> > the compiler at a magnitude that's impossible to be handled by the current
> > team.
> 
> (In reply to Stephan Herrmann from bug 531715 comment #48)
> > While I still think, flow-dependent resolution is crazy, I rethought our
> > situation more calmly, and see a slight possibility, that analyseCode could
> > be made to work in a speculative mode (post [14]):
> 
> I said: "slight possibility".

Sorry, from "impossible" downgraded to "slight possibility", I got carried away! :) </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-05T17:07:27Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> While experimenting with pattern-var vs. pattern-var conflicts I found this bug:

//---
public class Test {
    @SuppressWarnings("preview")
    void m(Object o1, Object o2) {
        if ((o1 instanceof String s)) {
            System.out.println(s.toUpperCase());
        } else {
            if (o2 instanceof String s) { // this confuses our analysis
                System.out.println(s.toUpperCase());
            } else {
                return;
            }
            return;
        }
        if (o2 instanceof String s) { // error should be shown here
            System.out.println(s.toUpperCase());
        } else {
            return;
        }
        System.out.println(s.toLowerCase());
    }
}
//---


ecj keeps silent, but when we remove the nested if, then ecj correctly reports:

1. ERROR in /tmp/Test.java (at line 9)                                                                                                                
        if (o2 instanceof String s) {                                                                                                                 
                                 ^                                                                                                                    
Duplicate local variable s


It looks like our analysis only considers the nested thing as a candidate for conflict (because it is "nearer"). Due to 'return' it is not a conflict, but we should also check if the top 's' is at conflict. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-05T18:06:01Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Another issue found while experimenting:

public class X {

    private String x;
    public void f(Object obj, boolean b) {
        if ((x instanceof String x)) {
            System.out.println(x.toLowerCase());// Wrong Error: The pattern variable x is not in scope in this location

        } else {
//         
        }
    }
	public static void main(String[] args) {
		new X().f(new Integer(1), false);
	}
}

First x refers to the field x - ecj incorrectly resolving to pattern variable x. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-06T05:29:18Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Manoj Palat from comment #5)
> First x refers to the field x - ecj incorrectly resolving to pattern
> variable x.

This is because the pattern variable is incorrectly resolved before we resolve the Instanceof expression. The reported error in the THEN statement is a fallout of that. This can easily be fixed and not a serious problem. Bigger issue what happens in the ELSE. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-06T08:26:17Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #2)
> > [...]
> > I'm afraid if ecj is forced to implement this, this requires re-architecting
> > the compiler at a magnitude that's impossible to be handled by the current
> > team.
> 
> (In reply to Stephan Herrmann from bug 531715 comment #48)
> > While I still think, flow-dependent resolution is crazy, I rethought our
> > situation more calmly, and see a slight possibility, that analyseCode could
> > be made to work in a speculative mode (post [14]):

Stephan, I am just thinking aloud here as an alternate to run the analyseCode in speculative mode ahead of resolution. Could be total non-sense, but bear with me since I don't have the full picture of the compiler:

What if, when we resolve, if we come across a pattern variable, we keep that as "the node" but continue to look for other matches, let's say a field and keep that one too, let's say "fallback". Later on when we analyze and come to know that the pattern var is not in scope, then all the relevant code is resolved again with the fallback. Other than the cost of re-resolving, do you see any issues? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-06T11:40:00Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/162554 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-06T11:58:33Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #7)
> What if, when we resolve, if we come across a pattern variable, we keep that
> as "the node" but continue to look for other matches, let's say a field and
> keep that one too, let's say "fallback". Later on when we analyze and come
> to know that the pattern var is not in scope, then all the relevant code is
> resolved again with the fallback. Other than the cost of re-resolving, do
> you see any issues?

Or AST is not prepared for re-resolving. See how lambdas take pains at creating AST *copies* before speculative resolution (inside type inference, and against a candidate target type), to ensure that there's no illegal influence between parallel universes. Looking from individual AST nodes, see how some of them effectively block re-resolving. We would need a fresh copy of a method body for every possible combination of resolution attempts against pattern variables. Additionally, how to cope with type errors in one attempt, that are not type errors in another? Not sure this will simplify anything in the end. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-06T11:58:51Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> s/Or/Our/ </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-12T23:24:40Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> I'd like to move this bug to 4.17, but that target does not yet exist in bugzilla ... using generic 4.16 instead. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-13T07:33:32Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #11)
> I'd like to move this bug to 4.17, but that target does not yet exist in
> bugzilla ... using generic 4.16 instead.

Or we can take this up in BETA_JAVA15 as part of the second preview? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-13T10:11:08Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #12)
> Or we can take this up in BETA_JAVA15 as part of the second preview?

Sorry, ill conceived. I thought we will have the Java 15 work in time. But no. So, will take this up in 4.17. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-08-24T06:56:28Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Finally, dusted this off today. 

My understanding about the solution that Stephan outlined in bug 531715, comment 48 is this:

1. Before we complete the resolution, we kick off flow analysis in a speculative mode.
2. This round of flow analysis in speculative mode, will
   i) not report any errors
   ii) Will not set any bits/flags
3. The result of the flow analysis is used for creating the pattern variable in only the right scopes when we resume resolution.
4. There on, resolution is completed and the regular flow analysis is kicked off.

Now some points I gathered looking at the code:
1. Obviously, the speculative mode flow analysis can't be triggered without resolving the statement that contains the pattern matching statement. 
2. Now, the question that remains to be answered is, how much of the statement should we resolve? For instance, in the "if" statement, is it enough to resolve just the "condition"? Similarly, can we run the flow analysis on just the "condition" alone? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-08-24T10:57:30Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #14)
> 2. Now, the question that remains to be answered is, how much of the
> statement should we resolve? For instance, in the "if" statement, is it
> enough to resolve just the "condition"? Similarly, can we run the flow
> analysis on just the "condition" alone?

Okay, if we want to know whether or not a block of code completes normally, then we must analyze both the "condition" and the "then" statement. And given that resolution is a pre-condition to analysis, we have no choice but to resolve the whole statement involved, in this example, the if statement. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-08-24T11:21:32Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Other potential problem we might encounter with this approach is with the following code:

if ((b instanceof String s) && (s.length() != 0))

I thought during the first speculative mode of flow analysis, we can initialize a secret local variable and use that during the follow-up resolution to create the actual local variable. But with the above code, we will be in trouble. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-08-27T04:47:16Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #16)
> Other potential problem we might encounter with this approach is with the
> following code:
> 
> if ((b instanceof String s) && (s.length() != 0))
> 

The above code will be a pain when we have a similarly named variable/field in the outer scope too. Right now, I am staring at a chicken-egg problem. To be able to resolve "s" in the s.length(), I need to find the definite inits of the pattern matching expression by calling analyseCode(), which in turn requires resolve(). So, if we were to resolve the whole "condition", the s.length() might  resolve s to the variable/field in the outer scope.

Basically, we are looking at two rounds of resolution and the results of the first round perhaps to be discarded. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-02T12:15:15Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/c/jdt/eclipse.jdt.core/+/168660 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-03T04:03:19Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Manoj Palat from comment #5)
> Another issue found while experimenting:
> 
> ...
> First x refers to the field x - ecj incorrectly resolving to pattern
> variable x.

Actually, this is still an issue with the latest patch. The one given in comment #6 works fine now. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-03T05:27:39Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> The latest patch tries a different approach to solve this problem of shadowing and Swiss cheese problem in pattern matching variables. In short, I do a pre-analysis before resolving statements containing a pattern variables. This draws inspiration from the analyseCode() and very similar to FlowInfo.initsWhenTrue and FlowInfo.initsWhenFalse, the pre-analysis dives into the expression containing pattern variables and stores them in two different arrays. The pattern variable bindings that can be seen by respective AST nodes are stored in the AST nodes themselves. This is implemented in bunch of collectPatternVariablesToScope() methods.

Which nodes sees which pattern variables is determined by where they belong in the expression. For e.g, AND_AND_Expression, OR_OR_Expression and UnaryExpression all have different rules in propagating the variables. The pattern variables in scope of AST nodes are exposed by InvocationSite#getPatternVariablesWhenTrue(). To make things work during resolution, BlockScope#findVariable() has been changed to look for pattern variables in the corresponding invocation sites.

And lastly, two methods namely resolveWithPatternVariablesInScope() and injectPatternVariablesIfApplicable() are provided in Statement that nodes like IfStatement, WhileStatement, ForStatement etc. can use to activate/deactivate pattern variables of interest to the scope. For this, I have used ExtraCompilerModifiers.AccUnresolved.

The changes in AbstractMethodDeclaration, Argument and LocalDeclaration are nothing but reversal of the previous solution. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-03T07:19:13Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> One significant difference between this and previous solution is, we are no longer able to accurately say that 

"The pattern variable s is not in scope in this location"

Instead, we will only issue 

s cannot be resolved to a variable (or) s cannot be resolved depending on the invocation site.

But I guess that's the price we should pay for not letting the variable live in the irrelevant scopes. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-08T02:40:21Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #21)
> One significant difference between this and previous solution is, we are no
> longer able to accurately say that 
> 
> "The pattern variable s is not in scope in this location"
> 
> Instead, we will only issue 
> 
> s cannot be resolved to a variable (or) s cannot be resolved depending on
> the invocation site.

I would like to add that, we are at par with Javac with respect to this. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-08T04:23:04Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/c/jdt/eclipse.jdt.core/+/168660 was merged to [BETA_JAVA15].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=9c56002a7c3353a731cf08eb1cc844d7852d5c2d </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-08T04:33:36Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Okay, I went ahead and released the fix. I am fairly confident about the completeness of the fix. But not so sure about the design end whether there's s more efficient way to do this.

However, I have tried to isolate the fix areas as much as possible, so that there's no unnecessary impact on performance.

Stephan, I am still waiting on your inputs, though :) and for now keeping the bug open. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-14T07:24:47Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/c/jdt/eclipse.jdt.core/+/169282 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-15T15:16:16Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Challenging completeness of the solution re Assignments I tried this:

//---
public class X8 {
        public static void foo(Object b) {
                Object c = null;
                if (b != c) {
                        boolean flag = false;
                        if (flag = (b instanceof String s) )
                                System.out.println("s:" + s);
                        else 
                                System.out.println("b:" + b);
                        System.out.println(flag);
                }
        }
        public static void main(String[] obj) {
                foo(100);
                foo("abcd");
        }
}
//---

Here ecj & javac agree on rejecting. If I remove "flag =" in the condition then both compilers accept. Is that intended? I didn't check the spec but thought that the assignment would not change the flow in any relevant way, does it?

By comparison, this snippet is accepted by both compilers:
//---
		boolean f2, f3;
		if (f2=(f3 = (b == c)))
		    System.out.println(f2 && f3);
//---
This demonstrates that def-init analysis does look into (nested) assignments.

If pattern var scoping is modeled with similar logic, shouldn't it look into (boolean) assignments, too?

More weirdness: 
Accepted:
//---
	void bar(int i, int j) {
		boolean f2, f3, f4;
		if ((f3 = (i == 3)) && (f4 = (j == 4)))
		    System.out.println(f3 && f4);
	}
//---

Rejected:
//---
	void bar(int i, int j) {
		boolean f2, f3, f4;
		if (f2=((f3 = (i == 3)) && (f4 = (j == 4))))
		    System.out.println(f2 && f3 && f4);
	}
//---
-> "The local variable f4 may not have been initialized"

How could the use-site of f4 be reached without initializing f4?

Apparently, s.t. if funny with flow analysis for assignments even before the introduction of pattern variables.

Or am I missing some flow subtlety? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-15T16:03:19Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> After some experiments and nitpicks, I'll try to rephrase the design based on comment 20, to double check our understanding.

I see the general issue as partitioned into these:

(1) Pattern variables are unconditionally added to their enclosing BlockScope like regular locals. Just setting AccPatternVariable marks them as smth special.

(2) Generally, resolving a reference to a pattern var goes through BlockScope.findVariable(), which makes a slight distinction between regular and pattern vars: regular first, then pattern var. If the name matches a pattern var, you additionally check if the candidate is "in scope", see below.

(3) Analysis of an expression tree containing one or more pattern variables. This is the realm of Expression.collectPatternVariablesToScope(). The result is that Statement.patternVarsWhenTrue and Statement.patternVarsWhenFalse are populated (only pattern vars from the current expression tree).

(4) For nodes inside a given expression tree "in scope" checking only needs to consult the invocationSite's patternVarsWhenTrue to see if the candidate variable is one of them.

(5) For action statements inside a conditional statement (if-statement or loop), more work is needed to make pattern variables available, since we're no longer within the expression tree. For this purpose resolveWithPatternVariablesInScope() "pushes down" the patternVarsWhenTrue or patternVarsWhenFalse of the condition into the corresponding action (statement or block of statements, child of the current if or loop). 
During this process you temporarily "forget"  about the pattern-ness of the given pattern vars (since 
https://git.eclipse.org/r/c/jdt/eclipse.jdt.core/+/169282 : unset AccPatternVariable), to let BlockScope see them as regular vars with no further in-scope checking.

(6) For subsequent statements (after an if or loop declaring pattern vars) you conditionally graduate pattern vars to regular vars. Condition: there's only one path to normally complete the if or loop (based on doesNotCompleteNormally or !breaksOut). "Graduating" happens by permanently unsetting AccPatternVariable.

To illustrate where steps (4) - (6) apply in source code:

  if ((o instanceof String s) && s/*(4)*/.length() > 0) {
    System.out.println(s/*(5)*/);
  } else {
    return; // doesNotCompleteNormally()
  }
  return s/*(6)*/;

Resolvable, because:
4. binding for s is in SingleNameReference.patternVarsWhenTrue
5. binding for s temporarily has AccPatternVariable unset
6. binding for s permanently has AccPatternVariable unset


This overall design looks suitable and solid. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-15T16:35:36Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Based on comment 27 (hoping that my grasp of the design is correct) I still have a few comments:

The implementation is scattered over several places, which probably matches the problem, but still listing here:
* role of BlockScope is obvious
* implement collectPatternVariablesToScope within the hierarchy of Expression
  also fits the needs
* much of the remaining parts are implemented in Statement. When we recall that
  Expression is a subtype of Statement, this makes sense.
  * I was pondering if injectPatternVariablesIfApplicable really depends on 'this'
    It wouldn't be hard to refactor this into a static method that could be moved
    anywhere, but due to relation to resolveWithPatternVariablesInScope it is
    actually well placed.
* allocating getPatternVariablesWhenTrue() into InvocationSite is a cool trick,
  it's just a bit - tricky - to see where this is implemented :)
  Since Statement doesn't implement InvocationSite there's nowhere in the code
  where we explicitly see both the declaration in InvocationSite and the 
  implementation in Statement. Miracles of multiple inheritance. :)
  -> Worth a comment in InvocationSite?

So far so good, just thinking aloud to convince myself of soundness.


There's still one issue that I haven't completely made up my mind about: it's the combination of visitor plus overrides at collectPatternVariablesToScope:

Comment 26 was the result of attempting to break the implementation: several non-trivial expression nodes are handled by the visitor, which does not trigger recursive collectPatternVariablesToScope. Hence, wrapping a sub-tree containing a pattern var in one of those nodes will potentially "hide" the pattern var, like (a = (o instanceof String s)).

The extent of this issue is fairly limited: 
We're looking for non-trivial expression types (that can contain an instanceof pattern). 
Everything below OperatorExpression is already handled via specific overrides.
The expression must have a boolean value, which can be determined locally. This rules out more types incl. AllocationExpression & MessageSend.
CastExpression: is it legal to say
  if ((boolean)(o instanceof String s)) print(s);
?
I guess even when casting to Boolean, JLS will not allow the information to flow through the double conversion, to put s into the varsWhenTrue of the cast expression (aka if condition).

That's why I ended up focusing on assignments, where the examples I gave seemed to make sense at first. Time to dive into the spec to check how assignments *should* be handled. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-15T16:41:45Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #26)
> Challenging completeness of the solution re Assignments I tried this:
> ...
> 
> Here ecj & javac agree on rejecting. If I remove "flag =" in the condition
> then both compilers accept. Is that intended? I didn't check the spec but
> thought that the assignment would not change the flow in any relevant way,
> does it?

I see this in the spec under 6.3.1:

Only certain boolean expressions can introduce a new pattern variable into scope. If an expression is not a logical complement expression, conditional-and expression, conditional-or expression, conditional expression, or instanceof operator, then no rules apply regarding the introduction of pattern variables.

Does this help? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-15T17:15:08Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #29)
> (In reply to Stephan Herrmann from comment #26)
> > Challenging completeness of the solution re Assignments I tried this:
> > ...
> > 
> > Here ecj & javac agree on rejecting. If I remove "flag =" in the condition
> > then both compilers accept. Is that intended? I didn't check the spec but
> > thought that the assignment would not change the flow in any relevant way,
> > does it?
> 
> I see this in the spec under 6.3.1:
> 
> Only certain boolean expressions can introduce a new pattern variable into
> scope. If an expression is not a logical complement expression,
> conditional-and expression, conditional-or expression, conditional
> expression, or instanceof operator, then no rules apply regarding the
> introduction of pattern variables.
> 
> Does this help?

Right on, case resolved :)
thanks.

Just one follow-up from that list of supported boolean expressions:
What is the purpose of the override in BinaryExpression? It doesn't match anything from the spec, and removing doesn't break any tests. For a moment I thought I could use this information to create a failing test, tried combinations with == but couldn't prove a bug :) </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-15T17:35:02Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #29)
> I see this in the spec under 6.3.1:
> 
> Only certain boolean expressions can introduce a new pattern variable into
> scope. If an expression is not a logical complement expression,
> conditional-and expression, conditional-or expression, conditional
> expression, or instanceof operator, then no rules apply regarding the
> introduction of pattern variables.

To relate this to the implementation even closer we can say:
- expressions in the above list override collectPatternVariablesToScope,
  these provide pattern variables to their context
- name references are the leaves reached via the visitor for all other exprs.
  these consume pattern variables from their context
Nice!

(Argument is the odd one out, covered only for clash detection). </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-17T04:29:33Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Considering that lot of discussion has happened on this bug, I am continuing to use this for incorporating review comments. But the fixes will be made in master, hence adjusting the target accordingly. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-17T04:30:05Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/c/jdt/eclipse.jdt.core/+/169492 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-17T04:32:18Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #33)
> New Gerrit change created:
> https://git.eclipse.org/r/c/jdt/eclipse.jdt.core/+/169492

Changes included in this patch:

1. BinaryExpression#collectPatternVariablesToScope() removed
2. Using BooleanSupplier instead of Predicate
3. Renamed injectPatternVariablesIfApplicable() to promotePatternVariablesIfApplicable() 
4. Not using AccUnresolved, but AccPatternVariable to promote pattern variables
5. Added new tests for usage and shadowing of pattern variables in lambda body and anonymous class creation </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-17T05:15:56Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/c/jdt/eclipse.jdt.core/+/169492 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=1df205b8b9fc46e15ab2480a118947865b69f8cc </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-09-17T05:17:54Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Thanks a lot, Stephan!

Resolving the bug. Follow up issues, hopefully none, if any can be taken up in new bugs. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-10-01T09:47:44Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Verified for 4.18 M1 Version: 2020-12 (4.18) with Build id: I20200930-1800 </td> </tr>
        </table>
</body>
</html>
