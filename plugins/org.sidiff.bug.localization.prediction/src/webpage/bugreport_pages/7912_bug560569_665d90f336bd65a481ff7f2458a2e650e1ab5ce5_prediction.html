<html>

<style>
html{
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ;
    font-size: 17px;
    display: table;
}
table,th,td {
  border: 1px solid black;
  width: 1200;
  text-align:justify;
  word-break:break-all;
}

th{
background-color: lightskyblue;
font-size: 16px;
border: none;
text-align:left;
}

td{
background-color: #d5e3c8;
font-size: 14px;
}

.container {
  position: relative;
  text-align:center;
  padding-top: 70%;
}

.responsive-iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border: 2px solid #73AD21;
}

</style>
<body>

<h2>Bug report Information</h2>
<table>

    <th colspan="2"> Bug Report </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bug Report Number </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 560569 </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Summary </td>
        <td  style="width: 80%; background-color:#f7fff0;"> [14] generated record class file has some kind of weird side effect </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Creation Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2020-02-26T21:54:25Z </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Status </td>
        <td  style="width: 80%; background-color:#f7fff0;"> RESOLVED </td>
    </tr>

    <th colspan="2"> Bug Fix </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bugfix Commit </td>
        <td  style="width: 80%; background-color:#f7fff0;"> Bug 558008 - [14] Record - DOM AST rewrite support
Typo correction

Change-Id: I834343b8099842177b21e2b7b2ba84af31396706
 </td>
    </tr>
    <tr>
        <td  tyle="width: 20%; background-color:#d5e3c8;"> Bugfix Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2020-03-07T03:04:10Z </td>
    </tr>
    </table>
<table>

<th colspan="2"> Ranked List of Class Diagrams </th>

<tr>
<td  style="width: 20%; font-size: 10px; background-color:#d5e3c8">

            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ConstantPool; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RawGrowableArray; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> StreamHasher; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ClassFileToIndexConverter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Clinit; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Chunk; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> TokenManager; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> LambdaMethod; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Util; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> AbstractRegressionTest$JavacTestOptions$EclipseHasABug; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ModificationLog$Tag; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> AbstractRegressionTest9; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Field; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Main; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IndexBinaryMethod; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BinaryIndexer; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> AbstractRegressionTest$JavacCompiler; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverterBugsTestJLS3; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> GeneratedResourceChangeListener$PreBuildVisitor; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavaPDOM; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IncrementalImageBuilder; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IDOMFactory; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Factory; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JDTCompilerAdapter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Field; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> HierarchyBinaryType; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavadocParser; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BinaryTypeFormatter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> GeneratedSourceFolderManager; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IDEInterface; </a> </li>
            </ul>   
            
</td>
<td  rowspan="30" style="width: 80%;  background-color:#d5e3c8"> 
    <div class="container">
    <iframe class="responsive-iframe" src="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" name="myIframe">
        <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html">SELFHTML</a>
    </iframe>
    </div>
</td>
</tr>
</table>
<table>

<th colspan="2"> Ranked List of Classifiers </th>

                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/codegen/ConstantPool; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/RawGrowableArray; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/DatabaseRef; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/pdom/StreamHasher; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/pdom/indexer/ClassFileToIndexConverter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/Clinit; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/pdom/db/Chunk; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/formatter/TokenManager; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/LambdaMethod; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/StreamHasher; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/util/Util; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/AbstractRegressionTest$JavacTestOptions$EclipseHasABug; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/db/ModificationLog$Tag; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/CombinedBinaryExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/AbstractRegressionTest9; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/pdom/field/Field; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/Annotation; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/batch/Main; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/java/model/IndexBinaryMethod; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/GenericsRegressionTest_1_8; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/search/indexing/BinaryIndexer; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/SwitchExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/AbstractRegressionTest$JavacCompiler; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/ASTConverterBugsTestJLS3; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/db/Database; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/db/ModificationLog; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.core/Lorg/eclipse/jdt/apt/core/internal/generatedfile/GeneratedResourceChangeListener$PreBuildVisitor; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/pdom/java/JavaPDOM; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/PrefixExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/builder/IncrementalImageBuilder; </td>
                </tr>

                </table>
<table>

<th colspan="2"> Discussion </th>

        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-26T21:54:25Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Hi all,
i've tested how records are generated with eclipse (applying the patch on a 4.15),
and the generated code is weird, like there is a side effect between the different records.

I've declared an interface and two records:
interface Rentable { int year(); }
record Car(String model, int year) implements Rentable {
  public Car {
    Objects.requireNonNull(model);
  }
  public String toString() {
    return model + " " + year;
  }
}
record Camel(int year) implements Rentable { }

Here is the code Eclipse generates for Car.class,
As you can see there is a lot of wrongs:
- the constructor is okay
- toString() doesn't use the StringConcatFactory for whatever reason ?
- model() and year() are okay
- hashCode() and equals() doesn't work because they reference a BSM (#0) that seems to come from Camel not from Car, this is very weird
  moreover the boostrap arguments of #0 and #1 are wrong too, the last bootstrap arguments should be direct method handle on the fields (model and year) not on the accessors (model() and year()), otherwise if one of the accessor calls equals or hashCode, we have an infinite loop.
- the attribute InnerClasses is wrong (Car has no inner classes)
- the attribute Record is okay.

Rémi

---
public fr.umlv.rental.Car(java.lang.String, int);
    descriptor: (Ljava/lang/String;I)V
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=2, locals=3, args_size=3
         0: aload_0
         1: invokespecial #14                 // Method java/lang/Record."<init>":()V
         4: aload_1
         5: invokestatic  #17                 // Method java/util/Objects.requireNonNull:(Ljava/lang/Object;)Ljava/lang/Object;
         8: pop
         9: aload_0
        10: aload_1
        11: putfield      #23                 // Field model:Ljava/lang/String;
        14: aload_0
        15: iload_2
        16: putfield      #25                 // Field year:I
        19: return
      LineNumberTable:
        line 6: 0
        line 7: 4
        line 8: 9
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      20     0  this   Lfr/umlv/rental/Car;
            0      20     1 model   Ljava/lang/String;
            0      20     2  year   I

  public java.lang.String toString();
    descriptor: ()Ljava/lang/String;
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=3, locals=1, args_size=1
         0: new           #33                 // class java/lang/StringBuilder
         3: dup
         4: aload_0
         5: getfield      #23                 // Field model:Ljava/lang/String;
         8: invokestatic  #35                 // Method java/lang/String.valueOf:(Ljava/lang/Object;)Ljava/lang/String;
        11: invokespecial #41                 // Method java/lang/StringBuilder."<init>":(Ljava/lang/String;)V
        14: bipush        32
        16: invokevirtual #44                 // Method java/lang/StringBuilder.append:(C)Ljava/lang/StringBuilder;
        19: aload_0
        20: getfield      #25                 // Field year:I
        23: invokevirtual #48                 // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
        26: invokevirtual #51                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
        29: areturn
      LineNumberTable:
        line 12: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      30     0  this   Lfr/umlv/rental/Car;

  public java.lang.String model();
    descriptor: ()Ljava/lang/String;
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: getfield      #23                 // Field model:Ljava/lang/String;
         4: areturn
      LineNumberTable:
        line 5: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature

  public int year();
    descriptor: ()I
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: getfield      #25                 // Field year:I
         4: ireturn
      LineNumberTable:
        line 5: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature

  public int hashCode();
    descriptor: ()I
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=5, locals=1, args_size=1
         0: aload_0
         1: invokedynamic #55,  0             // InvokeDynamic #0:hashCode:(Lfr/umlv/rental/Car;)I
         6: ireturn
      LineNumberTable:
        line 1: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature

  public boolean equals(java.lang.Object);
    descriptor: (Ljava/lang/Object;)Z
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=2, locals=2, args_size=2
         0: aload_0
         1: aload_1
         2: invokedynamic #60,  0             // InvokeDynamic #0:equals:(Lfr/umlv/rental/Car;Ljava/lang/Object;)Z
         7: ireturn
      LineNumberTable:
        line 1: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
}
SourceFile: "Car.java"
BootstrapMethods:
  0: #72 REF_invokeStatic java/lang/runtime/ObjectMethods.bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object;
    Method arguments:
      #73 fr/umlv/rental/Camel
      #75 year
      #78 REF_invokeVirtual fr/umlv/rental/Camel.year:()I
  1: #72 REF_invokeStatic java/lang/runtime/ObjectMethods.bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object;
    Method arguments:
      #1 fr/umlv/rental/Car
      #79 model;year
      #83 REF_invokeVirtual fr/umlv/rental/Car.model:()Ljava/lang/String;
      #85 REF_invokeVirtual fr/umlv/rental/Car.year:()I
InnerClasses:
  public static final #91= #87 of #89;    // Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandles
Record:
  java.lang.String model;
    descriptor: Ljava/lang/String;

  int year;
    descriptor: I </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-02T06:15:59Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Rémi Forax from comment #0)
> 
thanks Rémi for raising this. Here are the initial thoughts:
> Here is the code Eclipse generates for Car.class,
Part of the issue lies in the P build which is dated -(Bug 551486)- [yes, the MPE shouldn't give that link - will address] I used the Y Build to check the latest and here are the comments:
> As you can see there is a lot of wrongs:
> - the constructor is okay
> - toString() doesn't use the StringConcatFactory for whatever reason ?
Have created bug 560575 to address this since this is not a record-specific issue.

> - model() and year() are okay
> - hashCode() and equals() doesn't work because they reference a BSM (#0)
> that seems to come from Camel not from Car, this is very weird
hashCode() generated (with Y build) looks ok and has the same value as that generated via javac - BSM is from Car.class itself in this file.
>   moreover the boostrap arguments of #0 and #1 are wrong too, the last
> bootstrap arguments should be direct method handle on the fields (model and
> year) not on the accessors (model() and year()), otherwise if one of the
> accessor calls equals or hashCode, we have an infinite loop.
will take a look at these - yep, agree that last twi should be getField rather than the accessors - thanks.
> - the attribute InnerClasses is wrong (Car has no inner classes)
> - the attribute Record is okay.
> 

The class file generated with Y build is given below for reference:
Classfile Car.class
  Last modified 02-Mar-2020; size 1667 bytes
  SHA-256 checksum cd10b33b4a25d2978d7749acb414d9d121683de9f45eb00ef2933e42a1d5c528
  Compiled from "X.java"
final class Car extends java.lang.Record implements Rentable
  minor version: 65535
  major version: 58
  flags: (0x0030) ACC_FINAL, ACC_SUPER
  this_class: #1                          // Car
  super_class: #3                         // java/lang/Record
  interfaces: 1, fields: 2, methods: 6, attributes: 4
Constant pool:
   #1 = Class              #2             // Car
   #2 = Utf8               Car
   #3 = Class              #4             // java/lang/Record
   #4 = Utf8               java/lang/Record
   #5 = Class              #6             // Rentable
   #6 = Utf8               Rentable
   #7 = Utf8               model
   #8 = Utf8               Ljava/lang/String;
   #9 = Utf8               year
  #10 = Utf8               I
  #11 = Utf8               <init>
  #12 = Utf8               (Ljava/lang/String;I)V
  #13 = Utf8               Code
  #14 = Methodref          #3.#15         // java/lang/Record."<init>":()V
  #15 = NameAndType        #11:#16        // "<init>":()V
  #16 = Utf8               ()V
  #17 = Methodref          #18.#20        // java/util/Objects.requireNonNull:(Ljava/lang/Object;)Ljava/lang/Object;
  #18 = Class              #19            // java/util/Objects
  #19 = Utf8               java/util/Objects
  #20 = NameAndType        #21:#22        // requireNonNull:(Ljava/lang/Object;)Ljava/lang/Object;
  #21 = Utf8               requireNonNull
  #22 = Utf8               (Ljava/lang/Object;)Ljava/lang/Object;
  #23 = Fieldref           #1.#24         // Car.model:Ljava/lang/String;
  #24 = NameAndType        #7:#8          // model:Ljava/lang/String;
  #25 = Fieldref           #1.#26         // Car.year:I
  #26 = NameAndType        #9:#10         // year:I
  #27 = Utf8               LineNumberTable
  #28 = Utf8               LocalVariableTable
  #29 = Utf8               this
  #30 = Utf8               LCar;
  #31 = Utf8               toString
  #32 = Utf8               ()Ljava/lang/String;
  #33 = Class              #34            // java/lang/StringBuilder
  #34 = Utf8               java/lang/StringBuilder
  #35 = Methodref          #36.#38        // java/lang/String.valueOf:(Ljava/lang/Object;)Ljava/lang/String;
  #36 = Class              #37            // java/lang/String
  #37 = Utf8               java/lang/String
  #38 = NameAndType        #39:#40        // valueOf:(Ljava/lang/Object;)Ljava/lang/String;
  #39 = Utf8               valueOf
  #40 = Utf8               (Ljava/lang/Object;)Ljava/lang/String;
  #41 = Methodref          #33.#42        // java/lang/StringBuilder."<init>":(Ljava/lang/String;)V
  #42 = NameAndType        #11:#43        // "<init>":(Ljava/lang/String;)V
  #43 = Utf8               (Ljava/lang/String;)V
  #44 = String             #45            //
  #45 = Utf8
  #46 = Methodref          #33.#47        // java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
  #47 = NameAndType        #48:#49        // append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
  #48 = Utf8               append
  #49 = Utf8               (Ljava/lang/String;)Ljava/lang/StringBuilder;
  #50 = Methodref          #33.#51        // java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
  #51 = NameAndType        #48:#52        // append:(I)Ljava/lang/StringBuilder;
  #52 = Utf8               (I)Ljava/lang/StringBuilder;
  #53 = Methodref          #33.#54        // java/lang/StringBuilder.toString:()Ljava/lang/String;
  #54 = NameAndType        #31:#32        // toString:()Ljava/lang/String;
  #55 = Utf8               ()I
  #56 = Utf8               hashCode
  #57 = InvokeDynamic      #0:#58         // #0:hashCode:(LCar;)I
  #58 = NameAndType        #56:#59        // hashCode:(LCar;)I
  #59 = Utf8               (LCar;)I
  #60 = Utf8               equals
  #61 = Utf8               (Ljava/lang/Object;)Z
  #62 = InvokeDynamic      #0:#63         // #0:equals:(LCar;Ljava/lang/Object;)Z
  #63 = NameAndType        #60:#64        // equals:(LCar;Ljava/lang/Object;)Z
  #64 = Utf8               (LCar;Ljava/lang/Object;)Z
  #65 = Utf8               SourceFile
  #66 = Utf8               X.java
  #67 = Utf8               BootstrapMethods
  #68 = Methodref          #69.#71        // java/lang/runtime/ObjectMethods.bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object;
  #69 = Class              #70            // java/lang/runtime/ObjectMethods
  #70 = Utf8               java/lang/runtime/ObjectMethods
  #71 = NameAndType        #72:#73        // bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object;
  #72 = Utf8               bootstrap
  #73 = Utf8               (Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object;
  #74 = MethodHandle       6:#68          // REF_invokeStatic java/lang/runtime/ObjectMethods.bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object;
  #75 = String             #76            // model;year
  #76 = Utf8               model;year
  #77 = Methodref          #1.#78         // Car.model:()Ljava/lang/String;
  #78 = NameAndType        #7:#32         // model:()Ljava/lang/String;
  #79 = MethodHandle       5:#77          // REF_invokeVirtual Car.model:()Ljava/lang/String;
  #80 = Methodref          #1.#81         // Car.year:()I
  #81 = NameAndType        #9:#55         // year:()I
  #82 = MethodHandle       5:#80          // REF_invokeVirtual Car.year:()I
  #83 = Utf8               InnerClasses
  #84 = Class              #85            // java/lang/invoke/MethodHandles$Lookup
  #85 = Utf8               java/lang/invoke/MethodHandles$Lookup
  #86 = Class              #87            // java/lang/invoke/MethodHandles
  #87 = Utf8               java/lang/invoke/MethodHandles
  #88 = Utf8               Lookup
  #89 = Utf8               Record
{
  private final java.lang.String model;
    descriptor: Ljava/lang/String;
    flags: (0x0012) ACC_PRIVATE, ACC_FINAL

  private final int year;
    descriptor: I
    flags: (0x0012) ACC_PRIVATE, ACC_FINAL

  public Car(java.lang.String, int);
    descriptor: (Ljava/lang/String;I)V
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=2, locals=3, args_size=3
         0: aload_0
         1: invokespecial #14                 // Method java/lang/Record."<init>":()V
         4: aload_1
         5: invokestatic  #17                 // Method java/util/Objects.requireNonNull:(Ljava/lang/Object;)Ljava/lang/Object;
         8: pop
         9: aload_0
        10: aload_1
        11: putfield      #23                 // Field model:Ljava/lang/String;
        14: aload_0
        15: iload_2
        16: putfield      #25                 // Field year:I
        19: return
      LineNumberTable:
        line 5: 0
        line 6: 4
        line 7: 9
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      20     0  this   LCar;
            0      20     1 model   Ljava/lang/String;
            0      20     2  year   I

  public java.lang.String toString();
    descriptor: ()Ljava/lang/String;
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=3, locals=1, args_size=1
         0: new           #33                 // class java/lang/StringBuilder
         3: dup
         4: aload_0
         5: getfield      #23                 // Field model:Ljava/lang/String;
         8: invokestatic  #35                 // Method java/lang/String.valueOf:(Ljava/lang/Object;)Ljava/lang/String;
        11: invokespecial #41                 // Method java/lang/StringBuilder."<init>":(Ljava/lang/String;)V
        14: ldc           #44                 // String
        16: invokevirtual #46                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        19: aload_0
        20: getfield      #25                 // Field year:I
        23: invokevirtual #50                 // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
        26: invokevirtual #53                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
        29: areturn
      LineNumberTable:
        line 9: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      30     0  this   LCar;

  public java.lang.String model();
    descriptor: ()Ljava/lang/String;
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: getfield      #23                 // Field model:Ljava/lang/String;
         4: areturn
      LineNumberTable:
        line 4: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature

  public int year();
    descriptor: ()I
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: getfield      #25                 // Field year:I
         4: ireturn
      LineNumberTable:
        line 4: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature

  public final int hashCode();
    descriptor: ()I
    flags: (0x0011) ACC_PUBLIC, ACC_FINAL
    Code:
      stack=5, locals=1, args_size=1
         0: aload_0
         1: invokedynamic #57,  0             // InvokeDynamic #0:hashCode:(LCar;)I
         6: ireturn
      LineNumberTable:
        line 1: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature

  public final boolean equals(java.lang.Object);
    descriptor: (Ljava/lang/Object;)Z
    flags: (0x0011) ACC_PUBLIC, ACC_FINAL
    Code:
      stack=2, locals=2, args_size=2
         0: aload_0
         1: aload_1
         2: invokedynamic #62,  0             // InvokeDynamic #0:equals:(LCar;Ljava/lang/Object;)Z
         7: ireturn
      LineNumberTable:
        line 1: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
}
SourceFile: "X.java"
BootstrapMethods:
  0: #74 REF_invokeStatic java/lang/runtime/ObjectMethods.bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object;
    Method arguments:
      #1 Car
      #75 model;year
      #79 REF_invokeVirtual Car.model:()Ljava/lang/String;
      #82 REF_invokeVirtual Car.year:()I
InnerClasses:
  public static final #88= #84 of #86;    // Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandles
Record:
  java.lang.String model;
    descriptor: Ljava/lang/String;

  int year;
    descriptor: I

Will update further. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T06:22:48Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Manoj Palat from comment #1)
> (In reply to Rémi Forax from comment #0)
> > 
> >   moreover the boostrap arguments of #0 and #1 are wrong too, the last
> > bootstrap arguments should be direct method handle on the fields (model and
> > year) not on the accessors (model() and year()), otherwise if one of the
> > accessor calls equals or hashCode, we have an infinite loop.
> will take a look at these - yep, agree that last twi should be getField
> rather than the accessors - thanks.

https://git.eclipse.org/r/#/c/158708/ takes care of this via commit https://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA14&id=226f750049a9b41bd361ef869ab2e734f3d112d6 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T14:25:34Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/158740 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T15:00:26Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/158708 was merged to [BETA_JAVA14].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=226f750049a9b41bd361ef869ab2e734f3d112d6 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T15:00:31Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/158708 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T23:46:29Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/158740 was merged to [BETA_JAVA14].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=ad33648384270b784ad2878e500f82e5194f5b67 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-06T21:24:17Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Manoj,
using the Y version of Eclipse you send me,
the same bug that generates a class with both the bootstrap methods of the two records in the same class occurs again.

A project "clean" makes the bug disappear. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-07T12:50:40Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Created attachment 282039
Project used (tgz)

(In reply to Rémi Forax from comment #7)
> Manoj,
> using the Y version of Eclipse you send me,
> the same bug that generates a class with both the bootstrap methods of the
> two records in the same class occurs again.
> 
> A project "clean" makes the bug disappear.

@Rémi: Unfortunately I am not able to reproduce this error - I am attaching the zipped version of Project alongwith the generated class files and .prefs 

I've used the latest Y build now available at https://download.eclipse.org/eclipse/downloads/drops4/Y20200305-0600/

Can you please zip and attach the Project in which you are seeing this issue? Thanks </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-07T13:58:22Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Created attachment 282040
java class files

here is the classes i'm using to see the bug,
when it doesn't work, some JUnit tests are failing </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-08T06:19:45Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Rémi Forax from comment #9)
> Created attachment 282040 [details]
> java class files
> 
> here is the classes i'm using to see the bug,
> when it doesn't work, some JUnit tests are failing

Thanks Rémi! Finally able to reproduce the issue - looks like an cleanup/reset missing out - working on the same now. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-08T08:04:18Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/158994 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-08T09:07:47Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/158994 was merged to [BETA_JAVA14].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=d92f20e7ce752561e581c2c9a51bcb5817f26adc </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-08T12:13:09Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Hi Manoj,
I'm glad you think the issue :)

Just for my own understanding, why do you need to have a special field containing the bootstrap method specific to a record equals/hashCode/toString methods given that you already have a field for all bootstrap methods ? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-09T10:48:51Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Adding of "final" in hashcode and equals method is making the class loading fail for record. Works fine with 25th Y build but does not work with 5th March Y build. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-09T17:04:57Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Sarika Sinha from comment #14)
> Adding of "final" in hashcode and equals method is making the class loading
> fail for record. Works fine with 25th Y build but does not work with 5th
> March Y build.

@Sarika: I believe this comment was intended for the debug bug? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-09T17:16:51Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Rémi Forax from comment #13)
> Hi Manoj,
> I'm glad you think the issue :)
:)
> Just for my own understanding, why do you need to have a special field
> containing the bootstrap method specific to a record
> equals/hashCode/toString methods given that you already have a field for all
> bootstrap methods ?
In the ideal way, yes - we could have had just one - but the code was tied up with lambda metafactory - found it better to have additional one for records - will look into coalescing the code in future - Resolving the bug now. Thanks Remi! </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-09T17:39:28Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Manoj Palat from comment #15)
> (In reply to Sarika Sinha from comment #14)
> > Adding of "final" in hashcode and equals method is making the class loading
> > fail for record. Works fine with 25th Y build but does not work with 5th
> > March Y build.
> 
> @Sarika: I believe this comment was intended for the debug bug?

Yes Manoj. "final" keyword is the only difference between generated class files where Classloader is able to load a record. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-10T03:22:32Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Sarika Sinha from comment #17)

> Yes Manoj. 

@Sarika: Can you please file a new bug (if it is not there yet) on the debug class loading issue? Please add your specific case there which doesn't load in debug mode. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-12T05:00:38Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Manoj Palat from comment #18)
> (In reply to Sarika Sinha from comment #17)
> 
> > Yes Manoj. 
> 
> @Sarika: Can you please file a new bug (if it is not there yet) on the debug
> class loading issue? Please add your specific case there which doesn't load
> in debug mode.

This debug class loading issue is captured in bug 560995 </td> </tr>
        </table>
</body>
</html>
