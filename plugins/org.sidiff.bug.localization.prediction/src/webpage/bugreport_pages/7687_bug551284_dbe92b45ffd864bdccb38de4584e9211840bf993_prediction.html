<html>

<style>
html{
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ;
    font-size: 17px;
    display: table;
}
table,th,td {
  border: 1px solid black;
  width: 1200;
  text-align:justify;
  word-break:break-all;
}

th{
background-color: lightskyblue;
font-size: 16px;
border: none;
text-align:left;
}

td{
background-color: #d5e3c8;
font-size: 14px;
}

.container {
  position: relative;
  text-align:center;
  padding-top: 70%;
}

.responsive-iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border: 2px solid #73AD21;
}

</style>
<body>

<h2>Bug report Information</h2>
<table>

    <th colspan="2"> Bug Report </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bug Report Number </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 551284 </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Summary </td>
        <td  style="width: 80%; background-color:#f7fff0;"> build path cycle message lists too many projects to be useful </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Creation Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2019-09-19T21:51:31Z </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Status </td>
        <td  style="width: 80%; background-color:#f7fff0;"> VERIFIED </td>
    </tr>

    <th colspan="2"> Bug Fix </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bugfix Commit </td>
        <td  style="width: 80%; background-color:#f7fff0;"> Bug 551368 - VerifyError with latest jdt.core code on master

Change-Id: I628b2263e573b29ad15c53ae9b7c3c5330a03432
 </td>
    </tr>
    <tr>
        <td  tyle="width: 20%; background-color:#d5e3c8;"> Bugfix Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2019-09-24T07:39:44Z </td>
    </tr>
    </table>
<table>

<th colspan="2"> Ranked List of Class Diagrams </th>

<tr>
<td  style="width: 20%; font-size: 10px; background-color:#d5e3c8">

            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavaBuilder; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavaProjectTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Initializer; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JdtApt; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BuildJarIndex; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Indexer; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> APIDocumentationTests$JavaCoreJavadocAnalyzer; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Util; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> AbstractRegressionTest$JavacCompiler; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ClasspathUtil; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> MatchLocator; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> TestingEnvironment; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavaIndex; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> FileSystem; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ModuleUtil$ModuleAccumulatorEnvironment; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IndexSelector; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RunOnlyJava8Tests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> XLargeTest2; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Indexer; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> APTProblem; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IdeFilerImpl; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Database; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> GeneratedResourceChangeListener$PreBuildVisitor; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Options; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> EclipseCompilerImpl; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverter18Test; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompilationUnit; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ResourceHelper; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IndexBasedHierarchyBuilder; </a> </li>
            </ul>   
            
</td>
<td  rowspan="30" style="width: 80%;  background-color:#d5e3c8"> 
    <div class="container">
    <iframe class="responsive-iframe" src="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" name="myIframe">
        <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html">SELFHTML</a>
    </iframe>
    </div>
</td>
</tr>
</table>
<table>

<th colspan="2"> Ranked List of Classifiers </th>

                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/builder/JavaBuilder; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/JavaProjectTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/JavaProject; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/Initializer; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/JrtPackageFragmentRoot; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.core/Lorg/eclipse/jdt/apt/core/build/JdtApt; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/BuildJarIndex; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/CompilationUnit; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/pdom/indexer/Indexer; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/builder/ModuleInfoBuilder; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/dom/ASTConverter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/APIDocumentationTests$JavaCoreJavadocAnalyzer; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/util/Util; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.core/Lorg/eclipse/jdt/apt/core/build/AptBuilder; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/ExternalPackageFragmentRoot; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/AbstractRegressionTest$JavacCompiler; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.core/Lorg/eclipse/jdt/apt/core/internal/generatedfile/ClasspathUtil; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/PackageFragmentRoot; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/ModelTestsUtil; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/search/matching/MatchLocator; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/IJavaProject; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.builder/Lorg/eclipse/jdt/core/tests/builder/TestingEnvironment; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/java/JavaIndex; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/JavaIndexTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/batch/FileSystem; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/util/ModuleUtil$ModuleAccumulatorEnvironment; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/search/IndexSelector; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/util/ASTNodeFinder; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/batch/Main; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/JModPackageFragmentRoot; </td>
                </tr>

                </table>
<table>

<th colspan="2"> Discussion </th>

        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-19T21:51:31Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from bug 551147 comment #24)
> At first we only record this one-element cycle, but I already have an idea
> why the error message may become bloated with more projects.

(see that bug for context)


After we found the self-cycle on org.eclipse.osgi.services, we continue traversing the dependency tree. If at some point a -> b -> c we hit another dependency towards o.e.o.services, then we enter the full chain {a,b,c} to the list of cycleParticipants. Fine, so we know that {a,b,c,o.e.o.services} is a dangerous path. But I _believe_ we can find additional chains towards o.e.o.services and *all* these paths will be added to cycleParticipants. This looks bogus to me and should be fixed in JDT. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-21T20:44:21Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> It's worse than I thought: cycleParticipants is the *union of all projects* that either
* participate in a cycle or
* contribute to a path from one project outside the cycle *to* a cycle.

So my first thought was to separate:
- compute the cycle
- compute for each project the shortest path of dependencies towards the cycle

But this still falls short if there are several cycles.

Next I wonder if there is more of a contract behind this than just presenting a useful error message. See how org.eclipse.jdt.internal.core.builder.JavaBuilder.mustPropagateStructuralChanges() uses that information.

Trying to understanding that method I struggle to match "hasBeenBuilt(project)" to the message "has not yet seen some structural changes". Should that be !hasBeenBuilt()?? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-22T19:58:12Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/149955 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-22T20:31:04Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> @Andrey, @Jay, I'd appreciate if one (or both) of you could have a look at this:

(In reply to Eclipse Genie from comment #2)
> New Gerrit change created: https://git.eclipse.org/r/149955

Previously, scanning all projects only recorded which projects were seen as participating in some cycle, and the full list was shown in every error message in the workspace.
There was also an inconsistency, in whether or not projects depending on, but not participating in a cycle, should be counted, too:
- At the time of detecting a cycle the dependency-path leading to the cycle was ignored.
- If later we find another project depending on the cycle, then we add the path leading to the cycle.

In my change I record a full map of project -> CycleInfo where the latter is a new tiny structure capturing separately:
- the list of projects participating in the cycle
- a list of project via which a given project depends on the cycle.

With this we can now report like this
given:
  p1 -> p2, p5
  p2 -> p3
// cycle 1:
  p3 -> p4
  p4 -> p3
// cycle 2:
  p5 -> p6
  p6 -> p5

errors:
p1:
One or more cycles were detected in the build path of project 'p1'. The paths towards the cycle and cycle are:
p1, p2->{p3, p4}
p1->{p5, p6}

p2:
One or more cycles were detected in the build path of project 'p2'. The paths towards the cycle and cycle are:
p2->{p3, p4}

p3:
One or more cycles were detected in the build path of project 'p3'. The paths towards the cycle and cycle are:
->{p3, p4}

p4:
One or more cycles were detected in the build path of project 'p4'. The paths towards the cycle and cycle are:
->{p3, p4}

etc.pp.

This change currently lets 4 tests fail from ClasspathTest.testCycleDetection*.

I think those tests have inconsistent expectations regarding projects depending on a cycle. I'd like to update infrastructure for those tests to account to the new more fine grained reporting. But this I'll only if you agree with this direction.


Finally, there is JavaBuilder.mustPropagateStructuralChanges(), which I haven't yet relevantly touched. But if we fix the assumed inconsistency, then also that method should probably be adjusted. Similarly (and simpler) for JavaProject.hasClasspathCycle.

Specifically: should projects like p1, p2 above have a buildpath error or not? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-22T21:02:33Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #3) 
> With this we can now report like this
> given:
>   p1 -> p2, p5
>   p2 -> p3
> // cycle 1:
>   p3 -> p4
>   p4 -> p3
> // cycle 2:
>   p5 -> p6
>   p6 -> p5
> 
> errors:
> p1:
> One or more cycles were detected in the build path of project 'p1'. The
> paths towards the cycle and cycle are:
> p1, p2->{p3, p4}
> p1->{p5, p6}
> 
> p2:
> One or more cycles were detected in the build path of project 'p2'. The
> paths towards the cycle and cycle are:
> p2->{p3, p4}
> 
> p3:
> One or more cycles were detected in the build path of project 'p3'. The
> paths towards the cycle and cycle are:
> ->{p3, p4}
> 
> p4:
> One or more cycles were detected in the build path of project 'p4'. The
> paths towards the cycle and cycle are:
> ->{p3, p4}
> 
> etc.pp.

Sounds good.

> Specifically: should projects like p1, p2 above have a buildpath error or
> not?

I would say not (not sure if we have somewhere a contract about error reporting for cycles documented). 

I believe if the project itself is not a part of a cycle, but just depends on projects with cyclic dependencies, it shouldn't be marked with error.

In such crazy scenarios like bug 551147 we see errors on almost every workspace project, because they all use osgi services (most of them indirectly), and this not helpful but rather confusing and hides the original issue.

In my broken workspace with the new patch I clearly see now that it is osgi bundle alone that seem to be broken, and not all other bundles.

However, I'm not sure what would happen if the p1, p2 in your example would depend on some code in p3 that could not be compiled due the cycle of p3? We will probably have some "class p3.ABC can't be resolved" errors - along with the error on p3 about the cycle it should be enough to understand where the error is coming from. So it sounds that we don't need an extra cycle error for p1 and p2. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-22T21:39:04Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Andrey Loskutov from comment #4)
> > Specifically: should projects like p1, p2 above have a buildpath error or
> > not?
> 
> I would say not (not sure if we have somewhere a contract about error
> reporting for cycles documented). 
> 
> I believe if the project itself is not a part of a cycle, but just depends
> on projects with cyclic dependencies, it shouldn't be marked with error.

I haven't tried, but it could happen that if we don't issue the cycle problem, we'd get instead:

The project was not built since it depends on p3, which has build path errors

This could happen in particular in those cases you describe, were the cycle causes resolve errors.

Additionally, I'm not sure how this plays with indirect dependencies. I'll test these things next time around.

> In such crazy scenarios like bug 551147 we see errors on almost every
> workspace project, because they all use osgi services (most of them
> indirectly), and this not helpful but rather confusing and hides the
> original issue.
> 
> In my broken workspace with the new patch I clearly see now that it is osgi
> bundle alone that seem to be broken, and not all other bundles.

But the proposed error message would invariable show s.t. like the following on all transitively affected projects:

One or more cycles were detected in the build path of project 'x'. The paths towards the cycle and cycle are:
x, y, z->{org.eclipse.osgi.services}

Wouldn't that clearly point at the culprit? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-23T03:50:44Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #5)
> But the proposed error message would invariable show s.t. like the following
> on all transitively affected projects:
> 
> One or more cycles were detected in the build path of project 'x'. The paths
> towards the cycle and cycle are:
> x, y, z->{org.eclipse.osgi.services}
> 
> Wouldn't that clearly point at the culprit?

Yes, and that additional (and very useful information) will be nice IMHO. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-23T08:37:37Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #5)
> (In reply to Andrey Loskutov from comment #4)
> > In such crazy scenarios like bug 551147 we see errors on almost every
> > workspace project, because they all use osgi services (most of them
> > indirectly), and this not helpful but rather confusing and hides the
> > original issue.
> > 
> > In my broken workspace with the new patch I clearly see now that it is osgi
> > bundle alone that seem to be broken, and not all other bundles.
> 
> But the proposed error message would invariable show s.t. like the following
> on all transitively affected projects:
> 
> One or more cycles were detected in the build path of project 'x'. The paths
> towards the cycle and cycle are:
> x, y, z->{org.eclipse.osgi.services}
> 
> Wouldn't that clearly point at the culprit?

Sure. I guess you misunderstood my comment. I meant: today we see too many unrelated errors, and with your patch I see now only relevant projects mentioned in the error, so the new behavior after the patch is better. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-24T15:33:21Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/149955 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=bd56845ca277b92292b685d59ebbddf51541f702 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-24T15:47:52Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #8)
> Gerrit change https://git.eclipse.org/r/149955 was merged to [master].
> Commit:
> http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
> ?id=bd56845ca277b92292b685d59ebbddf51541f702

Released for 4.14 M1

Some of the tests in MultiProjectsTests now show more cycles than I had expected, but at closer look those create a densely linked graph of projects (e.g., 3 projects linked by 5 dependencies), so results look good.

The last thing I added (reminded by ClasspathTests): detection of overlapping cycles like in this error message (sharing the edge P1-P0):

One or more cycles were detected in the build path of project 'P0'. The paths towards the cycle and cycle are:
->{P0, P2, P3, P1}
->{P0, P4, P5, P1}

This was needed to detect that actually all projects participate in at least one cycle. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-25T09:30:26Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> We have one additional fail in jdt.ui due this fix:

https://download.eclipse.org/eclipse/downloads/drops4/I20190924-1800/testresults/html/org.eclipse.jdt.ui.tests_ep414I-unit-cen64-gtk3-java8_linux.gtk.x86_64_8.0.html

test2Cyclic	Failure	expected:<[A cycle was detected in the build path of project '2_CyclicA'. The cycle consists of projects ]{2_CyclicA, 2_Cyclic...> but was:<[One or more cycles were detected in the build path of project '2_CyclicA'. The paths towards the cycle and cycle are: ->]{2_CyclicA, 2_Cyclic...>

junit.framework.ComparisonFailure: expected:<[A cycle was detected in the build path of project '2_CyclicA'. The cycle consists of projects ]{2_CyclicA, 2_Cyclic...> but was:<[One or more cycles were detected in the build path of project '2_CyclicA'. The paths towards the cycle and cycle are:
->]{2_CyclicA, 2_Cyclic...>
at junit.framework.Assert.assertEquals(Assert.java:100)
at junit.framework.Assert.assertEquals(Assert.java:107)
at junit.framework.TestCase.assertEquals(TestCase.java:269)
at org.eclipse.jdt.ui.tests.buildpath.BuildpathProblemQuickFixTest.test2Cyclic(BuildpathProblemQuickFixTest.java:174)

I will push the patch. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-25T09:32:14Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/150102 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-25T12:07:00Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/150102 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.ui.git/commit/?id=632effbc1517eb7e6f3348936591032b531afa91 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-25T12:07:51Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Andrey Loskutov from comment #10)
> We have one additional fail in jdt.ui

Should be fixed by:

> Gerrit change https://git.eclipse.org/r/150102 was merged to [master].
> Commit:
> http://git.eclipse.org/c/jdt/eclipse.jdt.ui.git/commit/
> ?id=632effbc1517eb7e6f3348936591032b531afa91 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-25T13:44:27Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Andrey Loskutov from comment #13)
> (In reply to Andrey Loskutov from comment #10)
> > We have one additional fail in jdt.ui
> 
> Should be fixed by:
> 
> > Gerrit change https://git.eclipse.org/r/150102 was merged to [master].
> > Commit:
> > http://git.eclipse.org/c/jdt/eclipse.jdt.ui.git/commit/
> > ?id=632effbc1517eb7e6f3348936591032b531afa91

Thanks, Andrey! </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-10-09T14:44:34Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Verified for Eclipse Version: 2019-12 (4.14) M1 with  Build id: I20191008-1800 </td> </tr>
        </table>
</body>
</html>
