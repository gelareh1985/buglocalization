<html>

<style>
html{
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ;
    font-size: 17px;
    display: table;
}
table,th,td {
  border: 1px solid black;
  width: 1200;
  text-align:justify;
  word-break:break-all;
}

th{
background-color: lightskyblue;
font-size: 16px;
border: none;
text-align:left;
}

td{
background-color: #d5e3c8;
font-size: 14px;
}

.container {
  position: relative;
  text-align:center;
  padding-top: 70%;
}

.responsive-iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border: 2px solid #73AD21;
}

</style>
<body>

<h2>Bug report Information</h2>
<table>

    <th colspan="2"> Bug Report </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bug Report Number </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 465085 </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Summary </td>
        <td  style="width: 80%; background-color:#f7fff0;"> [null] False positive potential null warning/error when using isInstance() </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Creation Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2015-04-21T07:46:48Z </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Status </td>
        <td  style="width: 80%; background-color:#f7fff0;"> VERIFIED </td>
    </tr>

    <th colspan="2"> Bug Fix </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bugfix Commit </td>
        <td  style="width: 80%; background-color:#f7fff0;"> Bug 561287 - Incremental compilation reports spurious compilation errors
with bigger workspaces

- band aid

Change-Id: I71246702519f3d7f10359a9a41967b80b0f9c718
 </td>
    </tr>
    <tr>
        <td  tyle="width: 20%; background-color:#d5e3c8;"> Bugfix Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2020-03-30T22:13:01Z </td>
    </tr>
    </table>
<table>

<th colspan="2"> Ranked List of Class Diagrams </th>

<tr>
<td  style="width: 20%; font-size: 10px; background-color:#d5e3c8">

            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CombinedBinaryExpression; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Factory; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompilerOptions; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> GenericsRegressionTest; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> NestedTypeBinding; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverterTest; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ProblemReporter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JDTCompilerAdapter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> InvocationSite$EmptyWithAstNode; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> AbstractRegressionTest$JavacCompiler; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Util; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Checks; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompilerToolTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> LambdaFactory; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BindingToIndexConverter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> NullAnnotationModelTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> NaiveASTFlattener; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ImplicitNullAnnotationVerifier$InheritedNonNullnessInfo; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> StructDef; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> FormatterRegressionTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> LoopingFlowContext; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> StructDef; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> StandAloneASTParserTest; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BatchCompiler; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RunCompilerTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RegressionTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BuildNotifier; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Database; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BindingMap; </a> </li>
            </ul>   
            
</td>
<td  rowspan="30" style="width: 80%;  background-color:#d5e3c8"> 
    <div class="container">
    <iframe class="responsive-iframe" src="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" name="myIframe">
        <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html">SELFHTML</a>
    </iframe>
    </div>
</td>
</tr>
</table>
<table>

<th colspan="2"> Ranked List of Classifiers </th>

                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/CombinedBinaryExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.core/Lorg/eclipse/jdt/apt/core/internal/util/Factory; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/LambdaExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/dom/ASTConverter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/impl/CompilerOptions; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/GenericsRegressionTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/GenericsRegressionTest_1_8; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/lookup/NestedTypeBinding; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/NullReferenceTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/NullReferenceImplTests~Generator; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/ASTConverterTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/ASTConverterBugsTestJLS8; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/GenericsRegressionTest_9; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/ASTConverterJavadocTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/ASTConverterBugsTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/problem/ProblemReporter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/JDTCompilerAdapter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/ASTConverter18Test; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/CompilerInvocationTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/ASTConverter15Test; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/lookup/ProblemMethodBinding; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/ASTConverterAST3Test; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/dom/ASTConverter9Test; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/CastExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/dom/ASTRequestor; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/GenericsRegressionTest_1_7; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/lookup/MethodVerifier; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/dom/NullLiteral; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/LambdaRegressionTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/lookup/ConstraintExpressionFormula; </td>
                </tr>

                </table>
<table>

<th colspan="2"> Discussion </th>

        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2015-04-21T07:46:48Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> In a Java project with 'Java Compiler > Errors/Warnings > Null analysis > Potential null pointer access' set to Warning or Error I see two different results in the small snippet below.

The first example with 'instanceof' is the expected result: No error/warning is shown because 'mayBeNull' cannot be null.

In the second example, an error/warning from the compiler is shown which is in my opinion a false positive because the JavaDoc tells something like 'The method returns true if the specified Object argument is non-null...' for isInstance().

Seen with Eclipse 4.5 M6.

%< -----------------------------------------------------------

public class NullShowcase {

    public void demonstrateWorkingNullCheck() {
        Object mayBeNull = null;
        if (Math.random() > 0.5) {
            mayBeNull = new Object();
        }

        if (mayBeNull instanceof Object) {
            mayBeNull.toString();
        }
    }

    public void demonstrateNotWorkingNullCheck() {
        Object mayBeNull = null;
        if (Math.random() > 0.5) {
            mayBeNull = new Object();
        }
        if (Object.class.isInstance(mayBeNull)) {
            mayBeNull.toString();
        }
    }

} </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-11-12T19:58:26Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> This bug hasn't had any activity in quite some time. Maybe the problem got resolved, was a duplicate of something else, or became less pressing for some reason - or maybe it's still relevant but just hasn't been looked at yet.

If you have further information on the current state of the bug, please add it. The information can be, for example, that the problem still occurs, that you still want the feature, that more information is needed, or that the bug is (for whatever reason) no longer relevant.

--
The automated Eclipse Genie. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-11-12T21:41:26Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Generally, ecj doesn't read javadoc, so it doesn't know the contract of Class.isInstance().

This could be added as an enhancement, which would borrow from how we handle Objects.requireNonNull() mixed with how we analyse instanceof checks.

It is, however, not a direct extension of bug 382069, because with isInstance() communication is via the if-condition, not via exception throwing. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-28T19:43:16Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/160137 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-28T21:31:39Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/160137 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=78780b68b5ff0638fc0959b1558d0983c80ccaf0 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-28T23:00:08Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #4)
> Gerrit change https://git.eclipse.org/r/160137 was merged to [master].
> Commit:
> http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
> ?id=78780b68b5ff0638fc0959b1558d0983c80ccaf0

Released to master for 4.16 M1

Methods recognized:
- Class.isInstance result true implies argument nonnull
- Objects.nonNull  result true implies argument nonnull
- Objects.isNull   result true implies argument null

More methods can be added on request, if the contract is simple and obvious.

Detected methods are integrated as follows:
- invocation of a well-known method is detected as a simple expression or
  - as an operand to unary '!'
  - as an operand to binary '&&'
  - as an operand to binary '||'
- the following constructs propagate information from a condition to subsequent locations:
  - if: then positive, else negative
  - conditional expression: positive & negative
  - while & index for loops: body positive, code after the loop negative
  - binary &&: second operand positive
  - binary ||: second operand negative </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-28T23:08:07Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> *** Bug 553272 has been marked as a duplicate of this bug. *** </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-29T08:54:13Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> The compiler now reports false errors on code using Class.isInstance(x) code, saying x is not used or x can be null after positive check.

while (!(MPerspective.class.isInstance(parent) || MWindow.class.isInstance(parent))) {
	if (parent.getParent() == null) { // error here
		break;
	}
	parent = parent.getParent();
}


Null pointer access: The variable parent can only be null at this location	PartServiceImpl.java	/org.eclipse.e4.ui.workbench/src/org/eclipse/e4/ui/internal/workbench	line 913



for (Object o : elements) { // error here
	if (clazz.isInstance(o)) {
		count++;
	}
}

The value of the local variable o is not used	ModelServiceImpl.java	/org.eclipse.e4.ui.workbench/src/org/eclipse/e4/ui/internal/workbench	line 408 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-29T12:34:40Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Thanks. Silly mistake: I'm treating these two patterns in the same way:

    if (Objects.nonNull(x)) {
        // is is nonnull here
    } else {
        // x is null here
    }

    if (SomeClass.class.isInstance(x)) {
        // is is nonnull here
    } else {
        // x is null here // WRONG
    }

Obviously, the effect of isInstance(x) must not be negated. If isInstance() returns false we simply don't know anything about x's nullness.


The second part regarding unused o I cannot reproduce. Please provide a self-contained example. This is accepted with no warning/error whatsoever:

import java.util.*;
public class Y {
    static int m(List<Object> elements, Class<?> clazz) {
        int count = 0;
        for (Object o : elements) { // error here
            if (clazz.isInstance(o)) {
		count++;
            }
        }
        return count;
    }
} </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-29T13:12:02Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/160152 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-29T14:40:12Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/160152 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=61a4dab578c7398aef3409a2b85df5352d8e7063 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-29T14:41:13Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #10)
> Gerrit change https://git.eclipse.org/r/160152 was merged to [master].
> Commit:
> http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
> ?id=61a4dab578c7398aef3409a2b85df5352d8e7063

Additional fix released for 4.16 M1 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-30T08:40:10Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #8)
> The second part regarding unused o I cannot reproduce. Please provide a
> self-contained example. This is accepted with no warning/error whatsoever:
> 
> import java.util.*;
> public class Y {
>     static int m(List<Object> elements, Class<?> clazz) {
>         int count = 0;
>         for (Object o : elements) { // error here
>             if (clazz.isInstance(o)) {
> 		count++;
>             }
>         }
>         return count;
>     }
> }

I guess it is because default to show warning, not error for the unused variables.

Please import org.eclipse.e4.ui.workbench project in your SDK workspace and recompile it using I20200329-1800 SDK, you will see an error "The value of the local variable o is not used".

Also the example below (copied 1:1 from org.eclipse.e4.ui.internal.workbench.ModelServiceImpl.instanceCount(Collection<?>, Class<?>)) shows that 

package snippet;

import java.util.Collection;

public class Snippet {
	private int instanceCount(Collection<?> elements, Class<?> clazz) {
		int count = 0;
		for (Object o : elements) {  // warning here: "The value of the local variable o is not used"
			if (clazz.isInstance(o)) {
				count++;
			}
		}
		return count;
	}
} </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T13:54:06Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> @Stephan: the compiler error prevents us from contribution on Platform UI, because gerrit fails with the compilation error now.

Could we please have a fix?

See
https://ci.eclipse.org/platform/job/eclipse.platform.ui-Gerrit/22103/consoleFull

15:32:36 Some blocking (most likely link/compilation) errors are present:
15:32:36 * Marker [on: /org.eclipse.e4.ui.workbench/src/org/eclipse/e4/ui/internal/workbench/ModelServiceImpl.java, id: 83, type: org.eclipse.jdt.core.problem, attributes: [arguments: 1:o, categoryId: 120, charEnd: 15688, charStart: 15687, id: 536870973, lineNumber: 408, message: The value of the local variable o is not used, severity: 2, sourceId: JDT], created: 3/31/20 1:32 PM]
15:32:36 Some blocking (most likely link/compilation) errors are present ^^^ </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T13:58:57Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/160250 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T13:59:38Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #14)
> New Gerrit change created: https://git.eclipse.org/r/160250

This is just a workaround I need to get gerrit working again for Platform UI. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T14:55:51Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Andrey Loskutov from comment #12)
> (In reply to Stephan Herrmann from comment #8)
> > The second part regarding unused o I cannot reproduce. Please provide a
> > self-contained example. This is accepted with no warning/error whatsoever:
> > 
> > import java.util.*;
> > public class Y {
> >     static int m(List<Object> elements, Class<?> clazz) {
> >         int count = 0;
> >         for (Object o : elements) { // error here
> >             if (clazz.isInstance(o)) {
> > 		count++;
> >             }
> >         }
> >         return count;
> >     }
> > }
> 
> I guess it is because default to show warning, not error for the unused
> variables.

Unlikely, my experiments above always used -warn:+all and no warning was shown.
 
> Please import org.eclipse.e4.ui.workbench project in your SDK workspace and
> recompile it using I20200329-1800 SDK, you will see an error "The value of
> the local variable o is not used".
> 
> Also the example below (copied 1:1 from
> org.eclipse.e4.ui.internal.workbench.ModelServiceImpl.
> instanceCount(Collection<?>, Class<?>)) shows that 
> 
> package snippet;
> 
> import java.util.Collection;
> 
> public class Snippet {
> 	private int instanceCount(Collection<?> elements, Class<?> clazz) {
> 		int count = 0;
> 		for (Object o : elements) {  // warning here: "The value of the local
> variable o is not used"
> 			if (clazz.isInstance(o)) {
> 				count++;
> 			}
> 		}
> 		return count;
> 	}
> }

Interestingly:

$ ecj -1.8 -warn:+all Snippet.java
----------
1. WARNING in /tmp/Snippet.java (at line 4)
        private int instanceCount(Collection<?> elements, Class<?> clazz) {
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
The method instanceCount(Collection<?>, Class<?>) from the type Snippet is never used locally
----------
2. WARNING in /tmp/Snippet.java (at line 4)                                                                                                           
        private int instanceCount(Collection<?> elements, Class<?> clazz) {                                                                           
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                             
The method instanceCount(Collection<?>, Class<?>) from the type Snippet can be declared as static                                                     
----------                                                                                                                                            
2 problems (2 warnings)                                                                                                                               

No unused local variable.

Not even "-err:+unused" triggers what you are reporting.


What exact compiler setting are needed to reproduce the problem? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T14:59:37Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Andrey Loskutov from comment #13)
> @Stephan: the compiler error prevents us from contribution on Platform UI,
> because gerrit fails with the compilation error now.
> 
> Could we please have a fix?
> 
> See
> https://ci.eclipse.org/platform/job/eclipse.platform.ui-Gerrit/22103/
> consoleFull
> 
> 15:32:36 Some blocking (most likely link/compilation) errors are present:
> 15:32:36 * Marker [on:
> /org.eclipse.e4.ui.workbench/src/org/eclipse/e4/ui/internal/workbench/
> ModelServiceImpl.java, id: 83, type: org.eclipse.jdt.core.problem,
> attributes: [arguments: 1:o, categoryId: 120, charEnd: 15688, charStart:
> 15687, id: 536870973, lineNumber: 408, message: The value of the local
> variable o is not used, severity: 2, sourceId: JDT], created: 3/31/20 1:32
> PM]
> 15:32:36 Some blocking (most likely link/compilation) errors are present ^^^

How can we check which ecj version was used by that build? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T15:05:03Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #17)
> (In reply to Andrey Loskutov from comment #13)
> > @Stephan: the compiler error prevents us from contribution on Platform UI,
> > because gerrit fails with the compilation error now.
> > 
> > Could we please have a fix?
> > 
> > See
> > https://ci.eclipse.org/platform/job/eclipse.platform.ui-Gerrit/22103/
> > consoleFull
> > 
> > 15:32:36 Some blocking (most likely link/compilation) errors are present:
> > 15:32:36 * Marker [on:
> > /org.eclipse.e4.ui.workbench/src/org/eclipse/e4/ui/internal/workbench/
> > ModelServiceImpl.java, id: 83, type: org.eclipse.jdt.core.problem,
> > attributes: [arguments: 1:o, categoryId: 120, charEnd: 15688, charStart:
> > 15687, id: 536870973, lineNumber: 408, message: The value of the local
> > variable o is not used, severity: 2, sourceId: JDT], created: 3/31/20 1:32
> > PM]
> > 15:32:36 Some blocking (most likely link/compilation) errors are present ^^^
> 
> How can we check which ecj version was used by that build?

Wait: that error is not reported during compilation but during API analysis?

By contrast, this part:

09:32:09 [INFO] --- tycho-compiler-plugin:1.6.0:compile (default-compile) @ org.eclipse.e4.ui.workbench ---
09:32:09 [INFO] Compiling 75 source files to /home/jenkins/agent/workspace/eclipse.platform.ui-Gerrit/bundles/org.eclipse.e4.ui.workbench/target/classes

reports 25 warnings, and after a quick scan I only found problems related to access restrictions. What am I missing?

Is API analysis using a different version of ecj than compilation? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T15:58:27Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #16)
> What exact compiler setting are needed to reproduce the problem?

The project settings are in git, see https://git.eclipse.org/c/platform/eclipse.platform.ui.git/tree/bundles/org.eclipse.e4.ui.workbench/.settings

Again: just import org.eclipse.e4.ui.workbench project in your SDK workspace and recompile it using any I20200329-1800+ SDK. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T16:50:54Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> A strange observation to be followed later:

If -preserveAllLocals is set, the local variable gets the missing USED flag set during BlockScope.computeLocalVariablePositions() called during the preamble of MethodDeclaration.generateCode(). As a result the local will be generated into the bytecode. And the warning will be reported.

If -preserveAllLocals is unset, the local variable will remain flagged UNUSED until SingleNameReference.generateCode() from MessageSend.generateCode() (name is 'o'). But then code generation will detect a discrepancy that is repaired by throwing new AbortMethod(CodeStream.RESTART_CODE_GEN_FOR_UNUSED_LOCALS_MODE, null);  This causes the previously reported warning to be removed.


The defaults for -preserveAllLocals are: IDE: true, batch: false. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T16:56:06Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Andrey Loskutov from comment #19)
> (In reply to Stephan Herrmann from comment #16)
> > What exact compiler setting are needed to reproduce the problem?
> 
> The project settings are in git, see
> https://git.eclipse.org/c/platform/eclipse.platform.ui.git/tree/bundles/org.
> eclipse.e4.ui.workbench/.settings

BTW:

org.eclipse.jdt.core.compiler.problem.suppressOptionalErrors=disabled

This is VERY RISKY, when at the same time optional warnings are configured as errors. We will never guarantee 100% correctness of those warnings, we cannot. The option to use @SuppressWarnings is crucial, but it's broken in those settings.

(And it puts unnecessary pressure on my person) </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T17:02:06Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/160263 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T17:37:54Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #21)
> org.eclipse.jdt.core.compiler.problem.suppressOptionalErrors=disabled
> 
> This is VERY RISKY, when at the same time optional warnings are configured
> as errors. We will never guarantee 100% correctness of those warnings, we
> cannot. The option to use @SuppressWarnings is crucial, but it's broken in
> those settings.
> 
> (And it puts unnecessary pressure on my person)

Stephan, I haven't invented them, feel free to push better settings. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T18:17:02Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/160263 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=0ca9ce0133667c7b75c2eb41398cdad2069d4e43 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-31T18:25:39Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #24)
> Gerrit change https://git.eclipse.org/r/160263 was merged to [master].
> Commit:
> http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
> ?id=0ca9ce0133667c7b75c2eb41398cdad2069d4e43

Additional fix released for 4.16 M1. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-08T05:18:30Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Verified for 4.16 M1 using build I20200407-1800 </td> </tr>
        </table>
</body>
</html>
