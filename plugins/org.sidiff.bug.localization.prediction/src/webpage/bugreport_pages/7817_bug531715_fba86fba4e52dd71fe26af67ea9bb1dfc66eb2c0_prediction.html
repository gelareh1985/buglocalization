<html>

<style>
html{
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ;
    font-size: 17px;
    display: table;
}
table,th,td {
  border: 1px solid black;
  width: 1200;
  text-align:justify;
  word-break:break-all;
}

th{
background-color: lightskyblue;
font-size: 16px;
border: none;
text-align:left;
}

td{
background-color: #d5e3c8;
font-size: 14px;
}

.container {
  position: relative;
  text-align:center;
  padding-top: 70%;
}

.responsive-iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border: 2px solid #73AD21;
}

</style>
<body>

<h2>Bug report Information</h2>
<table>

    <th colspan="2"> Bug Report </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bug Report Number </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 531715 </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Summary </td>
        <td  style="width: 80%; background-color:#f7fff0;"> [14] JEP 305: Pattern Matching for instanceof (Preview) </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Creation Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2018-02-27T08:14:30Z </td>
    </tr>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Status </td>
        <td  style="width: 80%; background-color:#f7fff0;"> VERIFIED </td>
    </tr>

    <th colspan="2"> Bug Fix </th>
    <tr>
        <td  style="width: 20%; background-color:#d5e3c8;"> Bugfix Commit </td>
        <td  style="width: 80%; background-color:#f7fff0;"> Bug 559331 - API tool invalid since tags in BETA_JAVA14 stream

Change-Id: Idd8c2562c052492dec596c25d8293fcdc0094e1e
Signed-off-by: Vikas Chandra <Vikas.Chandra@in.ibm.com> </td>
    </tr>
    <tr>
        <td  tyle="width: 20%; background-color:#d5e3c8;"> Bugfix Time </td>
        <td  style="width: 80%; background-color:#f7fff0;"> 2020-01-20T10:20:45Z </td>
    </tr>
    </table>
<table>

<th colspan="2"> Ranked List of Class Diagrams </th>

<tr>
<td  style="width: 20%; font-size: 10px; background-color:#d5e3c8">

            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ProblemReporter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IDOMFactory; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> SelectionEngine; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RunCompilerTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RawGrowableArray; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompilerOptions; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ModuleBuilderTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IField; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> AbstractRegressionTest; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> FieldInitsFakingFlowContext; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> FormatterRegressionTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> TokenTraverser; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverter; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> UnaryExpression; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ClassFileToIndexConverter; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> TokenScanner; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ReconcileFilerImpl; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> WrapPreparator; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CodeSnippetSkeleton; </a> </li>
            </ul>   
            
            <ul>
                <li style="font-weight: bold;"> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavadocParser; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ASTConverterJavadocTest; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> RawGrowableArray; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> TestFinalRoundProc; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> IProblem; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Database; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> JavaModelManager; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> BindingMap; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> ModulePattern; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> CompilerToolTests; </a> </li>
            </ul>   
            
            <ul>
                <li> <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" target="myIframe"> Factory; </a> </li>
            </ul>   
            
</td>
<td  rowspan="30" style="width: 80%;  background-color:#d5e3c8"> 
    <div class="container">
    <iframe class="responsive-iframe" src="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html" name="myIframe">
        <a href="C:/Users/gelareh/git/buglocalization/plugins/org.sidiff.bug.localization.prediction/src/webpage/image_html_pages/diagram_default.html">SELFHTML</a>
    </iframe>
    </div>
</td>
</tr>
</table>
<table>

<th colspan="2"> Ranked List of Classifiers </th>

                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/problem/ProblemReporter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/jdom/IDOMFactory; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/codeassist/SelectionEngine; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/RunCompilerTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/pdom/RawGrowableArray; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/parser/Parser; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/codeassist/CompletionEngine; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/impl/CompilerOptions; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/ModuleBuilderTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/nd/field/IField; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/CodeCorrectionTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/AbstractRegressionTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/GenericsRegressionTest; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/flow/FieldInitsFakingFlowContext; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/CompilerInvocationTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/JEP286Test; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/formatter/FormatterRegressionTests; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/formatter/TokenTraverser; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/GenericsRegressionTest_1_8; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/core/dom/ASTConverter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; font-weight: bold; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/UnaryExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/ReferenceExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/GenericsRegressionTest_9; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/pdom/indexer/ClassFileToIndexConverter; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/core/dom/rewrite/TokenScanner; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/CombinedBinaryExpression; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.apt.core/Lorg/eclipse/jdt/apt/core/internal/env/ReconcileFilerImpl; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core/Lorg/eclipse/jdt/internal/compiler/ast/MessageSend; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.compiler/Lorg/eclipse/jdt/core/tests/compiler/regression/JavadocTest_1_5; </td>
                </tr>

                
                <tr>
                    <td  style="font-size: 12px; background-color:#d5e3c8"> org.eclipse.jdt.core.tests.model/Lorg/eclipse/jdt/core/tests/model/NullAnnotationModelTests; </td>
                </tr>

                </table>
<table>

<th colspan="2"> Discussion </th>

        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2018-02-27T08:14:30Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> https://bugs.openjdk.java.net/browse/JDK-8181287 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2018-02-27T10:15:43Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> How do you judge the relationship to bug 531714?

At least for grammar changes I'd suggest to start with Pattern Matching only after the parser for bug 531714 is done, do you agree? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-18T23:42:37Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Summary is this now:

Enhance the Java programming language with pattern matching for the instanceof operator. Pattern matching allows common logic in a program -- conditionally extracting components from objects -- to be expressed more concisely and safely. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-18T23:45:16Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #1)
> How do you judge the relationship to bug 531714?
> 
> At least for grammar changes I'd suggest to start with Pattern Matching only
> after the parser for bug 531714 is done, do you agree?

@Stephan: missed this comment: 
305 has now a reduced scope for instanceof. Now the relevant one for switch expressions is captured in https://bugs.openjdk.java.net/browse/JDK-8213076 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-18T23:56:30Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Manoj Palat from comment #3)
> 305 has now a reduced scope for instanceof. Now the relevant one for switch
> expressions is captured in https://bugs.openjdk.java.net/browse/JDK-8213076

please ref to bug 545513 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-19T13:05:30Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Manoj Palat from comment #4)
> (In reply to Manoj Palat from comment #3)
> > 305 has now a reduced scope for instanceof. Now the relevant one for switch
> > expressions is captured in https://bugs.openjdk.java.net/browse/JDK-8213076
> 
> please ref to bug 545513

Do you have indications that the original idea to support pattern matching in instanceof is still on the agenda? Where? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-19T13:07:14Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #5)
> (In reply to Manoj Palat from comment #4)
> > (In reply to Manoj Palat from comment #3)
> > > 305 has now a reduced scope for instanceof. Now the relevant one for switch
> > > expressions is captured in https://bugs.openjdk.java.net/browse/JDK-8213076
> > 
> > please ref to bug 545513
> 
> Do you have indications that the original idea to support pattern matching
> in instanceof is still on the agenda? Where?

Forget the question, found the answer in comment 0.
But I don't see a "Fix version" in JDK-8181287 so this bug should probably drop its target [13], right? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-03-19T14:06:09Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #6)

> Forget the question, found the answer in comment 0.
> But I don't see a "Fix version" in JDK-8181287 so this bug should probably
> drop its target [13], right?

Looks like it will drop [13]. However, since it is still under the JEP 388 (13) dashboard as listed here: https://bugs.openjdk.java.net/secure/Dashboard.jspa?selectPageId=18216, will keep in the radar until it moves out of this dashboard. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-09-19T11:46:48Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Back in the radar for Java 14

Draft spec is in:

http://cr.openjdk.java.net/~gbierman/jep305/jep305-20190918/specs/patterns-instanceof-jls.html </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-10-29T08:12:01Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> A second, and hopefully final, draft language spec for JEP 305 (Pattern matching for instanceof) is available at:

http://cr.openjdk.java.net/~gbierman/jep305/jep305-20191021/specs/patterns-instanceof-jls.html </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2019-12-20T10:44:36Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> I have a patch with the grammar change, which I will post shortly. At the moment, I am yet to figure out how to introduce a variable that will have its scope limited to its current statement. Options are, 

a) introducing a new block scope just for this statement for the pattern variable
b) Introduce it in the upper scope, but find a way to discard it after the resolution of the current statement.

If someone has other better ideas, please chime in. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-08T10:56:42Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/155460 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-09T15:15:03Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #11)
> New Gerrit change created: https://git.eclipse.org/r/155460

The patch includes the grammar and AST resolution and code generation changes. The statements that contain a instanceof pattern expression are flagged and later we create sub-scopes to resolve the condition expressions and other relevant blocks or statements. There are couple of open items:

1. This doesn't yet work for the case where an then statement or the action of while block doesn't complete normally.

2. Right now, we look for statements containing Pattern matching expressions by means of AST traverse after we construct the method body. But I think this can be improved if we can mark the statement during the parsing time. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-14T06:20:29Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> My method of using a sub-scope to declare the pattern variable and use the same scope to resolve other relevant statements is proving to be inadequate, mostly for the following two scenarios:

1)

if (!(o instanceof String s)) {
	throw new IllegalArgumentException();
} else {
  System.out.print(s); // Allowed here
}
System.out.print(s); // This should be allowed

2)

for(int i = 0, length = (obj instanceof String s) ? s.length() : 0; ; ) {
  System.out.print(s.charAt(i)); // Not allowed
}


(1) Required some amount of code analysis to be done before making the 's' available after the if statement.

In case of (1), the pattern variable 's' is not available inside action, but 'i' is available even though both are resolved in the same scope.

So, this makes me think we have to do something special to somehow inject the pattern variables only in the specific scopes instead of just playing around with new sub scopes.

Stephan, can you think of anything? I don't see any precedence for this unless I missed something. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-14T07:05:54Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #13)
> Stephan, can you think of anything? I don't see any precedence for this
> unless I missed something.

I see you invented FakedTrackingVariable, which gets removed from the scope when we no longer need it. Do you think something like that will be a good fit here? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-14T11:23:36Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> When a pattern variable is not available at a location lexically after its declaration but still within the same enclosing block, would it suffice to resolve anyway and defer error reporting until analyseCode? Or could a new variable be legally introduced forcing resolution to select between two variables of the same name and within the same scope?

So, if I extend (2) like this:

for(int i = 0, length = (obj instanceof String s) ? s.length() : 0; ; ) {
  String s = getS(); // is this declaration legal?
  System.out.print(s.charAt(i)); // would this reference resolve to the regular local?
} </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-14T11:26:42Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #14)
> I see you invented FakedTrackingVariable, which gets removed from the scope
> when we no longer need it. Do you think something like that will be a good
> fit here?

The first difference: FakedTrackingVariable will never be found during resolve, it is only collected in the scope for evaluation during checkUnclosedCloseables(). </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-20T11:51:25Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/155460 was merged to [BETA_JAVA14].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=812ce14a4f745f02fbd1f5a93ecd4101bf3894ac </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-20T21:39:45Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #17)
> Gerrit change https://git.eclipse.org/r/155460 was merged to [BETA_JAVA14].
> Commit:
> http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
> ?id=812ce14a4f745f02fbd1f5a93ecd4101bf3894ac

Looking at the change in IfStatement you seem to hold on to a scope-based solution? Have you found ways to reconcile this approach with the non-nesting structure of pattern variables? Otherwise I wonder if these are things that will be reverted once we address bug 553145? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-21T07:39:42Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #18)
> Looking at the change in IfStatement you seem to hold on to a scope-based
> solution? 

Yes, that seemed to work for most cases. I need to start adding more complicated tests.

> Have you found ways to reconcile this approach with the
> non-nesting structure of pattern variables? Otherwise I wonder if these are
> things that will be reverted once we address bug 553145?

You are going to help me understand that by elaborating a bit :) </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-21T10:06:35Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #19)
> (In reply to Stephan Herrmann from comment #18)
> > Looking at the change in IfStatement you seem to hold on to a scope-based
> > solution? 
> 
> Yes, that seemed to work for most cases. I need to start adding more
> complicated tests.

Other outstanding issue (which I haven't covered in testcase is about handling a || condition involving a instanceof pattern. I will shortly add a testcase for this. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-21T13:32:34Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Few words about the patch:

In the resolution phase, we create two sub-scopes, one where the pattern variable, let's say (s), will be in scope and another where it won't be in scope. Depending on the context and the statement we are resolving, we pass the appropriate scope to individual statements/expressions.

As far as InstanceOfExpression itself is concerned, the whole action is split into two stages, namely resolvePatternVariable() and initializePatternVariables(). The latter is really part of the code generation which records the initialization PC for the variable that corresponds to the pattern. Some cases, I think it is called earlier than required, which needs to be investigated. Splitting resolvePatternVariable() from the generateCode allow the statements to introduce the variables where they deem appropriate, especially because of all the optimization we seem to be doing during code generation.

Few short-comings:

1. The doesNotCompleteNormally() is not enough (or correct) to cover the condition laid out by the spec for the while statement [1]
2. Comment #20
3. Test case PatternMatching14Test._test039()

Stephan, I haven't given much thought to flow analysis yet and not sure if this approach is good enough. It will be nice if you can glance over the patch and let me know if you find anything majorly wrong with the approach.

[1] "V is introduced by while (e) S iff V is introduced by e when false, and S does not contains a reachable break statement whose break target contains S." </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-21T14:57:34Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #19)
> (In reply to Stephan Herrmann from comment #18)
> > Have you found ways to reconcile this approach with the
> > non-nesting structure of pattern variables? Otherwise I wonder if these are
> > things that will be reverted once we address bug 553145?
> 
> You are going to help me understand that by elaborating a bit :)

Let me try: various analyseCode() methods have logic that very much looks like what you started to create when inventing things like "BlockScope trueScope". I'm afraid that the scope based approach would have to re-invent large portions of what we already have in analyseCode. Plus: FlowInfo is highly optimized for tracking the status of many variables, creation of individual FlowInfos for branches in the flow is cheap. Scopes seem more heavy weight, if you ask me.


Looking at this sentence from the spec:

"a pattern variable is only in scope at those program points where pattern matching will have succeeded and the pattern variable will have been definitely assigned a value."

We have all the machinery for determining "definitely assigned" in analyseCode() / FlowInfo. Depending on the interpretation of "and" in that sentence (is it a true conjunct, or two ways of describing the same?), checking 'definitely assigned' could be sufficient to determine legality of using a pattern variable.

The following (informative) sentence seems to confirm my understanding:

"In this sense, the scope of a pattern variable is a flow dependent concept similar to definite assignment (Chapter 16). The rules that are defined in the rest of this section deliberately have a similar form to those used in Chapter 16."


To further clarify I asked about some tricky cases in comment 15. Checking those with javac seems to refute my thinking about analyseCode(), see this simplified:
class Test {
    void m(Object obj) {
        if ((obj instanceof String s)) {
            System.out.print(s.charAt(1));
        } else {
            Number s = 4;
        }
    }
}
This is accepted by javac, but just by adding "!" before the instanceof expression we get:

Test.java:4: error: cannot find symbol
            System.out.print(s.charAt(1));
                             ^
  symbol:   variable s
  location: class Test
Test.java:6: error: variable s is already defined in method m(Object)
            Number s = 4;

The second error answers my question from above: we *cannot* naively ignore the flow during resolve, because the flow not only decides about legal / illegal, it also decides about the type of a local variable :(

Let me still ask, if we can use a simplified approximation during resolve, s.t., like: if reference 's' is legal at a location it resolves to the "closest" declaration in scope. So at the end of the else block, 's' is either a Number or illegal (to be determined by flow analysis). In the then block, 's' is either a String or illegal.


Is my thinking clearer now? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-22T05:14:14Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #22) 
> Is my thinking clearer now?

Yes, it is. In fact, I and Manoj were discussing the point you highlighted about the flow dependent concept when I started out. But my understanding was that analyseCode is too late to introduce local variables and perhaps was only reserved for changing initilization states. I earlier had a patch (now discarded), which looked like that, but then all the unresolved errors were reported as uninitialized variables.

Or is my understanding about analyseCode() wrong? Can we introduce a variables during this stage? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-22T16:27:42Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #23)
> (In reply to Stephan Herrmann from comment #22) 
> > Is my thinking clearer now?
> 
> Yes, it is. In fact, I and Manoj were discussing the point you highlighted
> about the flow dependent concept when I started out. But my understanding
> was that analyseCode is too late to introduce local variables and perhaps
> was only reserved for changing initilization states. I earlier had a patch
> (now discarded), which looked like that, but then all the unresolved errors
> were reported as uninitialized variables.
> 
> Or is my understanding about analyseCode() wrong? Can we introduce a
> variables during this stage?

You're right in that analyseCode is too late for *introducing* variables.

I still wonder if we can combine both worlds in an elegant way.

1. Suppose Scope knows two kinds of variables: normal vars & pattern vars.

2. Each pattern adds a pattern var to the scope.

3. At location X resolve needs to find a variable V.

4. If scope has a normal var named V, that's it.

5. Otherwise check what is the most recent (lexically) pattern variable known to the scope and speculatively use that.

6. Whether or not the resolution from (5) was valid must be rechecked during analyseCode, by asking: is var V definitely assigned at X?


Can shadowing between locals (normal vs. pattern) occur? I think none, right? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-23T10:20:36Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #24)
> 5. Otherwise check what is the most recent (lexically) pattern variable
> known to the scope and speculatively use that.
> 
> 6. Whether or not the resolution from (5) was valid must be rechecked during
> analyseCode, by asking: is var V definitely assigned at X?

This is what I am not sure, i.e, what exactly is the error we should report. Looking at Javac implementation and the spec, looks like we should only recognize the pattern variable V at X if all the conditions are met. The question of definitely assigned doesn't even arise here.

For example:

if (!(o instanceof String s)) {
  return s;   //1
} else {
  return s;  //2
}

Now, it's not enough if we just emit "s not assigned" at (1), is it? Javac calls "s" as unresolved. So, what am I missing? Or are you saying, we can still un-resolve a pattern variable from analyseCode?


> Can shadowing between locals (normal vs. pattern) occur? I think none, right?

You are right. This particular rule is mentioned in several places in the spec:

"It is a compile-time error if any pattern variable introduced by e when true is already in scope at S." </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-23T14:42:24Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #25)
> (In reply to Stephan Herrmann from comment #24)
> > 5. Otherwise check what is the most recent (lexically) pattern variable
> > known to the scope and speculatively use that.
> > 
> > 6. Whether or not the resolution from (5) was valid must be rechecked during
> > analyseCode, by asking: is var V definitely assigned at X?
> 
> This is what I am not sure, i.e, what exactly is the error we should report.
> Looking at Javac implementation and the spec, looks like we should only
> recognize the pattern variable V at X if all the conditions are met. The
> question of definitely assigned doesn't even arise here.
> 
> For example:
> 
> if (!(o instanceof String s)) {
>   return s;   //1
> } else {
>   return s;  //2
> }
> 
> Now, it's not enough if we just emit "s not assigned" at (1), is it? Javac
> calls "s" as unresolved. So, what am I missing? Or are you saying, we can
> still un-resolve a pattern variable from analyseCode?

If it's just a matter of a suitable error message I think it's easy to detect when we're about to report "not assigned" against a pattern variable, and rephrase this to "is unresolved" or similar. There should be no ambiguity which message to use, since pattern variables cannot be in-scope *and* unassigned at the same location, right?
You might say that I'm proposing to "abuse" def-assigned analysis for a new purpose :) - which in a way resembles how FakedTrackingVariable abuses the mechanism for null-analysis for resource leak analysis. I.e., how to communicate the result of flow analysis to users depends on the kind of variable.

 
> > Can shadowing between locals (normal vs. pattern) occur? I think none, right?
> 
> You are right. This particular rule is mentioned in several places in the
> spec:
> 
> "It is a compile-time error if any pattern variable introduced by e when
> true is already in scope at S."

Good! </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-27T06:50:08Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #26)
> If it's just a matter of a suitable error message I think it's easy to
> detect when we're about to report "not assigned" against a pattern variable,
> and rephrase this to "is unresolved" or similar. There should be no
> ambiguity which message to use, since pattern variables cannot be in-scope
> *and* unassigned at the same location, right?

Yes, that was my only concern.

> You might say that I'm proposing to "abuse" def-assigned analysis for a new
> purpose :) - which in a way resembles how FakedTrackingVariable abuses the
> mechanism for null-analysis for resource leak analysis. I.e., how to
> communicate the result of flow analysis to users depends on the kind of
> variable.

Well, the current solution I have posted falls short of addressing all scenarios. And obviously the spec stating that the pattern variable is flow dependent, this looks like a more logical choice. Just not yet sure if there will be any side effects of resolving the pattern variable at the earliest point.

I will try this and report back. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-27T11:22:23Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #24)
> You're right in that analyseCode is too late for *introducing* variables.
> 
> I still wonder if we can combine both worlds in an elegant way.
> 
> 1. Suppose Scope knows two kinds of variables: normal vars & pattern vars.
> 
> 2. Each pattern adds a pattern var to the scope.
> 
> 3. At location X resolve needs to find a variable V.
> 
> 4. If scope has a normal var named V, that's it.
> 
> 5. Otherwise check what is the most recent (lexically) pattern variable
> known to the scope and speculatively use that.
> 
> 6. Whether or not the resolution from (5) was valid must be rechecked during
> analyseCode, by asking: is var V definitely assigned at X?
> 
> 
> Can shadowing between locals (normal vs. pattern) occur? I think none, right?

To add, when there's a declaration like the one in comment #22 (Number s), we also need to look out for two conflicting declarations of normal and pattern variables. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-01-27T13:21:29Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> I am tempted to think we should still go the sub-scope way for cases like simple local declaration statement where the pattern variable was never visible beyond that statement itself. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-10T04:19:16Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/157409 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-10T04:48:09Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #30)
> New Gerrit change created: https://git.eclipse.org/r/157409

In this, I have removed all the sub-scope based code. I always resolve the pattern variable, but flag it so that when looking for local variables, these get filtered out (point 4 from bug 531715 comment 24). And as per point 5, we look specifically for the variables flagged in such a manner. I also use this flag to report appropriate error in ProblemReporter#uninitializedLocalVariable()

Now, a bug chunk of the work is left to be done during analyseCode(). I will start looking at this and depending on how things go, I will request Stephan to either take over or review the work. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-13T13:17:31Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #31)
> (In reply to Eclipse Genie from comment #30)
> > New Gerrit change created: https://git.eclipse.org/r/157409
> 
> In this, I have removed all the sub-scope based code. I always resolve the
> pattern variable, but flag it so that when looking for local variables,
> these get filtered out (point 4 from bug 531715 comment 24). And as per
> point 5, we look specifically for the variables flagged in such a manner. I
> also use this flag to report appropriate error in
> ProblemReporter#uninitializedLocalVariable()
> 
> Now, a bug chunk of the work is left to be done during analyseCode(). I will
> start looking at this and depending on how things go, I will request Stephan
> to either take over or review the work.

Great, if you compare patch set #2 against #1 you'll see how close to home you were already :)

Contained:
- feed assignment info into the right flowInfo (InstanceOfExpression)
- check for pattern var in one more ProblemReporter method
- I propose a new IProblem with message
    The pattern variable {0} is not in scope in this location
  This should help users understand that: yes we found your variable,
  but, no, you can't use it here.
- updated tests
  - adjust to the new message
  - expect expected errors :) in two tests (previously TODO)

The simplicity of the change in InstanceOfExpression seems to confirm we are on a good path, no?

Not done:
- we have three errors from codeGen, haven't looked at those
- 2 tests warn "dead code", is this situation intended? 
  I didn't want to mess the test.
- 1 test: error duplicate local variable

Regarding the "duplicate" error, I need to read more about what's legal here, but if we figure out that this error, too, is flow dependent, then a bit more work still lies ahead:
- avoid reporting duplicate during resolve
- recheck during analyseCode based on flowInfo </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-16T00:07:54Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Patch set #4 is again closer:

Defer the duplicate check until analyseCode (for pattern var & pattern var)

Again simpler than it should be :)


Next I ran tests with run.javac=enabled and made the following improvements:
- test001 not to use JAVAC_OPTIONS to raise the preview error as we do
- dead code warnings: avoid one, expect the other
- further disambiguate class names (which is indeed helpful to compare
  exact error messages vs. javac in run.javac mode)
- added test019b to assert that we still do detect duplicates (flow dependent)


test025 and test026 made my heart skip a beat, when I saw javac accepting this:
	if ((o instanceof String s) != p instanceof String s) {
		System.out.print(\"s:\" + s);
	}
which would indicate that they merge two pattern vars from different branches into one that is definitely assigned at the point of usage.
I was relieved to see that a newer javac 14 did not show this behavior and complains against the usage as we do (now - previously we complained against the second decl, which, however is legal).


At this point we're left with only three exceptions during code gen.

Back to you,  Jay, but feel free to keep asking. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-16T12:34:15Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/157409 was merged to [BETA_JAVA14].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=f8f67606ae10780ec62f44189f86b4bf1a166ba8 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-16T12:49:15Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #34)
> Gerrit change https://git.eclipse.org/r/157409 was merged to [BETA_JAVA14].
> Commit:
> http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
> ?id=f8f67606ae10780ec62f44189f86b4bf1a166ba8

I managed to fix the code gen issues (by propagating HasInstancePatternExpression in some places.

Please check the following left-overs:

- Is ASTNode.HasInstancePatternExpression really unique or is there a conflict with, e.g., UnnecessaryCast (also using Bit15 for expressions!)? Since bit space is very crowded, we might get away with a recursive implementation of Expression.hasInstancePatternExpression() instead of storing this information using #bits? If only needed for initializePatternVariables() we could perhaps completely abandon the flag and just always traverse the expression during initializePV() (potentially empty traversal).

- I updated duplicate-handling only for patternVar-vs-patternVar cases, but I imagine that the following may require similar treatment:
  if (o instanceof String s) {
      ...
  } else {
    String s = "hallo";
  }
i.e., a regular local may appear as conflicting until flow analysis proves absence of a conflict? I haven't checked the spec in this regard.


- Check: Do all statements containing a condition properly invoke initializePatternVariables()? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-17T06:26:35Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #35)
> (In reply to Eclipse Genie from comment #34)
> > Gerrit change https://git.eclipse.org/r/157409 was merged to [BETA_JAVA14].
> > Commit:
> > http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
> > ?id=f8f67606ae10780ec62f44189f86b4bf1a166ba8
> 
> I managed to fix the code gen issues (by propagating
> HasInstancePatternExpression in some places.

Thanks Stephan for the awesome work! And also thank you for cleaning up the left over sub-scope related code.

> Please check the following left-overs:

Back at work this week. Will go over these and take them to closure. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-17T06:46:21Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #36)
> Back at work this week. Will go over these and take them to closure.

One more item to look at:

In early stages of the work, someone had compared out bytecode with Javac and reported that we were producing smaller code (one less comparison):

https://mail.openjdk.java.net/pipermail/amber-dev/2020-January/005477.html

But I tried this again and found that we now have one additional ifeq instruction. Will see if this can be improved. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-17T22:38:08Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #37)
> (In reply to Jay Arthanareeswaran from comment #36)
> > Back at work this week. Will go over these and take them to closure.
> 
> One more item to look at:
> 
> In early stages of the work, someone had compared out bytecode with Javac
> and reported that we were producing smaller code (one less comparison):
> 
> https://mail.openjdk.java.net/pipermail/amber-dev/2020-January/005477.html

Interesting read :)
 
> But I tried this again and found that we now have one additional ifeq
> instruction. Will see if this can be improved.

Using the example from the list post, I see:

  static void example(java.lang.Object);
    descriptor: (Ljava/lang/Object;)V
    flags: (0x0008) ACC_STATIC
    Code:
      stack=2, locals=2, args_size=1
         0: aconst_null
         1: astore_1
         2: aload_0
         3: instanceof    #13                 // class java/lang/String
         6: dup
         7: ifeq          15
        10: aload_0
        11: checkcast     #13                 // class java/lang/String
        14: astore_1
        15: ifeq          22
        18: aload_1
        19: invokestatic  #15                 // Method nop:(Ljava/lang/String;)V
        22: return


The second 'ifeq' is generated from 
   this.condition.generateOptimizedBoolean(..)
inside IfStatement.generateCode()

That's the normal jump of the then block, right? Did a previous version of ecj pass the falseLabel into InstanceofExpression.generateCode(), so we could do a longer jump instead of two? From the current code I can't see how it ever generated the shorter sequence shown in that post. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-21T16:11:12Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #38)
> That's the normal jump of the then block, right? Did a previous version of
> ecj pass the falseLabel into InstanceofExpression.generateCode(), so we
> could do a longer jump instead of two? From the current code I can't see how
> it ever generated the shorter sequence shown in that post.

Agree with your finding. Given that the code didn't work for some of the scenarios, best not read much into that. Perhaps it is worth following up on the changes made for Javac and see if they managed achieve that. Will take that up at a later stage. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-02-27T05:00:09Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/158455 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-02T07:25:13Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #40)
> New Gerrit change created: https://git.eclipse.org/r/158455

This handles few left-outs including the ones mentioned in comment #35, except the duplicate-handling one.

I have added few more test case, some of them with fixes and some without. Mainly, ECJ is failing where there's a field involved.

1. The first case is obvious short-coming in code generation where we are trying to look for a local variable binding. I am on this. Example in PatternMatching14Test.test044().

2. The second is involving a field too, but seems more about flow analysis when a field is assigned to a local and later on the local variable being used in pattern matching. Example in PatternMatching14Test.test040().

Stephan, any hints for the latter? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T00:14:14Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #41)
> 2. The second is involving a field too, but seems more about flow analysis
> when a field is assigned to a local and later on the local variable being
> used in pattern matching. Example in PatternMatching14Test.test040().

I see the test continuing to use the field o1, not the local o2. Is that by intention? When changing the test to use o2, ecj accepts. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T06:50:08Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #42)
> (In reply to Jay Arthanareeswaran from comment #41)
> > 2. The second is involving a field too, but seems more about flow analysis
> > when a field is assigned to a local and later on the local variable being
> > used in pattern matching. Example in PatternMatching14Test.test040().
> 
> I see the test continuing to use the field o1, not the local o2. Is that by
> intention? When changing the test to use o2, ecj accepts.

Sorry, the description was wrong. The assignment from field to a local has nothing to do. It's the field itself that was left un-analyzed. Please read below.

(In reply to Jay Arthanareeswaran from comment #41)
> (In reply to Eclipse Genie from comment #40)
> > New Gerrit change created: https://git.eclipse.org/r/158455
> 
> This handles few left-outs including the ones mentioned in comment #35,
> except the duplicate-handling one.

This is the only one left now. I have handled flow analysis and code generation when the instanceof pattern matching involves a field declaration. The latest patch contains these fixes.

As of now, there are two failures: test039 and test043. The latter, I believe is same as the duplicating-handling one we are discussing. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T13:16:19Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #43)
> As of now, there are two failures: test039 and test043. The latter, I
> believe is same as the duplicating-handling one we are discussing.

I'm looking at test043 now. Hope you see this note despite bug 560725. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T14:00:56Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #44)
> (In reply to Jay Arthanareeswaran from comment #43)
> > As of now, there are two failures: test039 and test043. The latter, I
> > believe is same as the duplicating-handling one we are discussing.
> 
> I'm looking at test043 now. Hope you see this note despite bug 560725.

This is bad news, as it demonstrates that the type of a variable can depend on flow analysis. I'll need to think more about this.

Is it true, that hiding a local by a pattern-var is illegal, but hiding an outer-local by a pattern-var is legal? I can see that javac accepts this, but is this backed by the spec? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T14:32:27Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Found this in an "old" thread [1]:

"The idea of flow scoping is that a pattern variable is only *in scope* where it has definitely matched. Thus, in places where it is definitely not matched - like your else block - it is not in scope. Thus it doesn�t exist."

That was said in discussion concerning conflicts field vs. pattern var. And in all those discussions, the variables in question always had the same type - very misleadingly.

But it seems to indicate that the type of a name reference is indeed known only after flow analysis - which required resolving to happen first.

My immediate reaction: let's ignore this for now, and raise it to the EG for preview 2 with severity BLOCKER. Point in favor: the "swiss cheese" problem has already been discussed controversially within the EG. If they are presented with a huge problem they have overlooked, perhaps s.o. will change their mind.


Using a modified version of an example used in the mentioned thread:
//---
public class A {
    private Integer x;

    public void f(Object obj) {
        if (obj instanceof String x) {
            System.out.println(x.toLowerCase()); // x refers to pattern binding
        } else {
            System.out.println(x.intValue()); // x refers to the field
        }
    }
}
//---
oops: 'x' changes type from one line to the next.

Then add an 'innocent' "|| b":
//---
public class A {
    private Integer x;

    public void f(Object obj, boolean b) {
        if ((obj instanceof String x) || b) {
            System.out.println(x.toLowerCase()); // this is now a type error
        } else {
            System.out.println(x.intValue()); // x refers to the field
        }
    }
}
//---

I'm afraid if ecj is forced to implement this, this requires re-architecting the compiler at a magnitude that's impossible to be handled by the current team.


[1] https://mail.openjdk.java.net/pipermail/amber-spec-experts/2019-December/001837.html

PS: Perhaps in the light of the above my advice to use existing flow analysis was wrong. Perhaps your concept of new Scope magic was more appropriate. But mind you, that approach would've required to re-implement a LOT of what our analyseCode methods are doing. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T16:21:14Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #46)
> PS: Perhaps in the light of the above my advice to use existing flow
> analysis was wrong. Perhaps your concept of new Scope magic was more
> appropriate. But mind you, that approach would've required to re-implement a
> LOT of what our analyseCode methods are doing.

In the time I spent with that approach, I was beginning to understand that it was no trivial matter given the number of common testcases failing. The fact that I could remove quite a few lines of code and replace with only few lines of flow analysis code to make them work is our proof.

Yes, we should take it up with the EG. But given that Javac has already been made to work, I have my doubts. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-03T22:05:23Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> While I still think, flow-dependent resolution is crazy, I rethought our situation more calmly, and see a slight possibility, that analyseCode could be made to work in a speculative mode (post [14]):

- most effects of flow analysis only go into FlowInfo / FlowContext temporary structures. When we discard those, we can compute them several times over again (ignoring the performance aspect).

- I'm thinking of a flag 'boolean speculative' that would guard
  - other effects like setting any bits in the AST (like USED ...)
  - calls to the problem reporter

With such infra structure in place we could perform resolution in a way that any doubt, whether a pattern variable is in scope, would kick off analyseCode(speculative=true).

I'm not sure if this should then be the norm, or whether we first look for potential ambiguity vs. a field / local from outer context and do speculative flow analysis only for such disambiguation.

Surely, flow analysis that is invoked in the middle of resolving statements of a method cannot run to completion, because the remaining statements aren't yet resolved.

In another universe we could design the AST such that it stores all relevant information like flow infos etc, to the end that flow analysis could stop at any given point and resume with stored information from where it left of.

I could imagine that when javac was redesigned with tiered attribution some years back, it was in the direction of storing information in ast nodes such that resolving and various analyses can be more demand driven rather than in strict phases. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-09T05:49:58Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> *** Bug 553144 has been marked as a duplicate of this bug. *** </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-09T05:50:09Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> *** Bug 553145 has been marked as a duplicate of this bug. *** </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-09T05:50:16Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> *** Bug 553146 has been marked as a duplicate of this bug. *** </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-11T06:43:59Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/158455 was merged to [BETA_JAVA14].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=ff8398f15aafcf8583bb74da76b165cd0e423d22 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-12T10:21:57Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> *** Bug 553142 has been marked as a duplicate of this bug. *** </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-03-17T08:56:43Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Rest of the work to be taken up during 4.16. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-05T21:37:54Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Created attachment 282348
compile error using instanceof pattern

I noticed that this attached class does not compile in Eclipse, but is accepted by javac/java.

In Eclipse I get the following compiler error on line 5, when trying to use the String assigned as s:
Exception in thread "main" java.lang.Error: Unresolved compilation problem: 
	The pattern variable s is not in scope in this location

I have tested this in the latest JDT integration build I20200404.

If I assign getChars() to a variable before the if, this also compiles in Eclipse. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-08T16:00:32Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Rune Flobakk from comment #55)
> Created attachment 282348 [details]
> compile error using instanceof pattern

Reproduce. I am looking into this.

Stephan, as you can see, this is being planned for M2. Please let me know if I can contribute in any way about comment #48. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-08T21:26:08Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #56)
> (In reply to Rune Flobakk from comment #55)
> > Created attachment 282348 [details]
> > compile error using instanceof pattern
> 
> Reproduce. I am looking into this.
> 
> Stephan, as you can see, this is being planned for M2. Please let me know if
> I can contribute in any way about comment #48.

Do you see a connection between comment 55 and comment 48? From a quick glance I did not. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-09T04:04:49Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #57)
> Do you see a connection between comment 55 and comment 48? From a quick
> glance I did not.

No, I don't. Comment 55 is something I will look at. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-09T11:06:43Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #58)
> No, I don't. Comment 55 is something I will look at.

For convenience, here's the code:
public class InstanceOfPatternTest {
	public static void main(String[] args) {
		if (getChars() instanceof String s) {
			System.out.println(s);
		}
	}
	static CharSequence getChars() {
		return "xyz";
	}
}

First look, we are not hitting the new code in InstanceOfExpression#analyseCode() first IF block. On a quick attempt, by applying the similar fix to the flow info before finally returning from the method.

Stephan, do you think the direction is good? </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-09T11:51:18Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #59)
> (In reply to Jay Arthanareeswaran from comment #58)
> > No, I don't. Comment 55 is something I will look at.
> 
> For convenience, here's the code:
> public class InstanceOfPatternTest {
> 	public static void main(String[] args) {
> 		if (getChars() instanceof String s) {
> 			System.out.println(s);
> 		}
> 	}
> 	static CharSequence getChars() {
> 		return "xyz";
> 	}
> }
> 
> First look, we are not hitting the new code in
> InstanceOfExpression#analyseCode() first IF block. On a quick attempt, by
> applying the similar fix to the flow info before finally returning from the
> method.
> 
> Stephan, do you think the direction is good?

Yes, it seems this statement:
    initsWhenTrue.markAsDefinitelyAssigned(this.elementVariable.binding);
needs to be executed in all cases where this.elementVariable != null regardless of the type of this.expression. We just need to figure out, when to compute / copy initsWhenTrue and how to splice that into the returned flow info.

Probably the second toplevel if should split its condition:
    if (this.elementVariable != null) {
        if (this.expression instanceof Reference) { ... </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-13T22:45:09Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> *** Bug 562081 has been marked as a duplicate of this bug. *** </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-14T09:18:27Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Looks like gerrit issues are back. I just posted the fix here:

https://git.eclipse.org/r/#/c/160873/ </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-14T10:39:58Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Jay Arthanareeswaran from comment #62)
> Looks like gerrit issues are back. I just posted the fix here:
> 
> https://git.eclipse.org/r/#/c/160873/

Raised bug 562098 and hooked up with the umbrella bug 560911. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-14T13:57:01Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/160873 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-14T15:41:25Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/160873 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=a5d182a56da4684d8c90405e6432596d3d1bb373 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-16T08:00:47Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Eclipse Genie from comment #64)
> New Gerrit change created: https://git.eclipse.org/r/160873

Would like to cherry-pick this to BETA branch. Direct effort from gerrit failed. Will do it from local workspace. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-21T05:31:41Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> New Gerrit change created: https://git.eclipse.org/r/161263 </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-21T08:33:55Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Gerrit change https://git.eclipse.org/r/161263 was merged to [BETA_JAVA14].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=a02eb687bc599e2f068e6563968e361d28df74dc </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-04-22T04:47:53Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> (In reply to Stephan Herrmann from comment #35)
> - I updated duplicate-handling only for patternVar-vs-patternVar cases, but
> I imagine that the following may require similar treatment:
>   if (o instanceof String s) {
>       ...
>   } else {
>     String s = "hallo";
>   }
> i.e., a regular local may appear as conflicting until flow analysis proves
> absence of a conflict? I haven't checked the spec in this regard.

I raised bug 562379 for this and intend to take up the remaining issues either via bug 559960 or new bugs. Notable candidate is the shadowing of fields by pattern variables. </td> </tr>
        
        <tr>
            <td style="width: 20%; font-size: 12px; background-color:#d5e3c8"> Creation Time </td>
            <td style="width: 80%; font-size: 12px; background-color:#d5e3c8"> 2020-05-20T00:48:27Z </td>
        </tr>
        <tr> <td colspan="2" style="font-size: 12px; background-color:#f7fff0"> Verified for Eclipse Version: 2020-06 4.16 M3 with Build id: I20200519-1800 </td> </tr>
        </table>
</body>
</html>
